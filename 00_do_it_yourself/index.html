<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Autor:innenschaft</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/aframe/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
  <!-- VR Keyboard -->
  <script src="https://cdn.jsdelivr.net/gh/etiennepinchon/aframe-keyboard@1.0.4/dist/aframe-keyboard.min.js"></script>
  <!-- Tone.js entfernt -->
  <style>
    body{margin:0;overflow:hidden}
    #ui{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);z-index:999;font-family:Georgia,serif;text-align:center}
    #chapter-title{color:#fff;font-size:28px;opacity:0;transition:opacity 1s}
    #chapter-title.visible{opacity:1}
    #subtitle{color:#ccc;font-size:16px;font-style:italic;opacity:0;transition:opacity 1s 0.5s}
    #subtitle.visible{opacity:1}
    #hint{position:fixed;bottom:80px;left:50%;transform:translateX(-50%);color:#888;font-size:14px;font-family:Arial}
    #start-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:#000;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:2000}
    #start-screen h1{color:#fff;font-family:Georgia,serif;font-size:36px;margin-bottom:10px}
    #start-screen p{color:#888;font-family:Georgia,serif;font-size:16px;margin-bottom:30px}
    #start-screen button{background:#4ecdc4;border:none;color:#000;padding:15px 40px;font-size:18px;cursor:pointer;font-family:Georgia,serif}
    #ai-panel{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.95);padding:30px;border-radius:10px;display:none;z-index:1000;max-width:600px;width:90%;border:1px solid #4ecdc4}
    #ai-panel h3{color:#4ecdc4;margin:0 0 15px 0;font-family:Georgia,serif}
    #ai-panel textarea{width:100%;height:60px;background:#111;border:1px solid #333;color:#fff;padding:10px;font-family:Georgia,serif;font-size:14px;resize:none;box-sizing:border-box}
    #ai-panel button{background:#4ecdc4;border:none;color:#000;padding:10px 25px;margin-top:10px;cursor:pointer;font-family:Georgia,serif;font-size:14px}
    #ai-output{margin-top:20px;padding:15px;background:#1a1a1a;border-left:3px solid #e94560;color:#ccc;font-family:Georgia,serif;line-height:1.6;display:none;max-height:200px;overflow-y:auto}
    #ai-label{color:#e94560;font-size:12px;margin-bottom:5px}
    #final-panel{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.95);padding:30px;border-radius:10px;display:none;z-index:1000;max-width:500px;width:90%;border:1px solid #f39c12;text-align:center}
    #final-panel h3{color:#f39c12;margin:0 0 10px 0;font-family:Georgia,serif}
    #final-panel p{color:#888;font-size:14px;margin-bottom:20px}
    #final-panel textarea{width:100%;height:80px;background:#111;border:1px solid #333;color:#fff;padding:10px;font-family:Georgia,serif;font-size:16px;resize:none;box-sizing:border-box}
    #final-panel button{background:#f39c12;border:none;color:#000;padding:12px 30px;margin-top:15px;cursor:pointer;font-family:Georgia,serif;font-size:16px}
    #voices{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:500;display:none}
    .voice{position:absolute;color:rgba(255,100,100,0.8);font-family:Georgia,serif;font-style:italic;animation:fadeVoice 4s ease-in-out infinite;text-shadow:0 0 10px rgba(255,0,0,0.5)}
    @keyframes fadeVoice{0%,100%{opacity:0;transform:translateY(0)}50%{opacity:1;transform:translateY(-10px)}}
    #progress{position:fixed;top:20px;left:50%;transform:translateX(-50%);display:flex;gap:10px;z-index:999}
    .prog-dot{width:12px;height:12px;border-radius:50%;background:#333;transition:background 0.5s}
    .prog-dot.active{background:#4ecdc4}
    .prog-dot.complete{background:#2ecc71}
    #portal-hint{position:fixed;bottom:120px;left:50%;transform:translateX(-50%);color:#4ecdc4;font-size:16px;font-family:Georgia,serif;opacity:0;transition:opacity 0.5s}
    #portal-hint.visible{opacity:1}

    /* VR Button sichtbar machen */
    .a-enter-vr-button {
      position: fixed !important;
      bottom: 20px !important;
      right: 20px !important;
      z-index: 9999 !important;
      background-color: #2196F3 !important;
      border: 2px solid #fff !important;
      border-radius: 8px !important;
      padding: 12px 24px !important;
      font-size: 16px !important;
      font-weight: bold !important;
      color: white !important;
      cursor: pointer !important;
      display: block !important;
    }

    .a-enter-vr-button:hover {
      background-color: #1976D2 !important;
    }
  </style>
</head>
<body>
  <div id="start-screen">
    <h1>Autor:innenschaft</h1>
    <p>Eine interaktive Erfahrung</p>
    <!-- <button onclick="startExperience()">Erfahrung starten</button> -->
    <p style="margin-top:20px;font-size:12px;color:#555">üéß Kopfh√∂rer empfohlen</p>
  </div>

  <div id="progress" style="display:none">
    <div class="prog-dot active"></div>
    <div class="prog-dot"></div>
    <div class="prog-dot"></div>
    <div class="prog-dot"></div>
    <div class="prog-dot"></div>
    <div class="prog-dot"></div>
  </div>
  <div id="ui">
    <div id="chapter-title"></div>
    <div id="subtitle"></div>
  </div>
  <div id="hint" style="display:none">WASD = Bewegen ¬∑ Maus = Umsehen ¬∑ Klicken = Interagieren</div>
  <div id="portal-hint"></div>
  <div id="voices"></div>
  
  <div id="ai-panel">
    <h3>ü§ñ Die Maschine</h3>
    <p style="color:#888;font-size:14px;margin-bottom:15px">Gib ein Thema ein. Die KI schreibt sofort.</p>
    <textarea id="ai-input" placeholder="z.B. 'Einsamkeit', 'Liebe', 'Verg√§nglichkeit', 'Angst', 'Hoffnung', 'Schmerz', 'Sch√∂nheit', 'Tod', 'Freiheit', 'Einheit', 'Stille', 'Zeit', 'Verlust', 'Identit√§t', 'Vertrauen', 'Erinnerung', 'Kreativit√§t', 'Einfluss', 'Demut', 'Ekstase', 'Wahrheit', 'Schreiben', 'Scheitern', 'Schlaf', 'Rauschen', 'Farbe', 'Leere', 'Echo', 'Wasser', 'Feuer', 'Stimme', 'Raum', 'Dunkelheit', 'Grenze', 'Bewegung', 'Sprache'"></textarea>
    <button onclick="generateAI()">Generieren</button>
    <div id="ai-output"><div id="ai-label">KI-GENERIERT:</div><div id="ai-text"></div></div>
    <button onclick="closeAI()" style="background:#333;color:#fff;margin-left:10px">Weiter</button>
  </div>
  
  <div id="final-panel">
    <h3>‚úçÔ∏è Dein Satz</h3>
    <p>Trotz allem ‚Äì schreibe EINEN Satz. Deinen eigenen.<br>Die Stimmen, die Maschine, die Leere ‚Äì sie warten.<br>Aber nur du kannst diesen Raum verlassen.</p>
    <textarea id="final-input" placeholder="Dein Satz..."></textarea>
    <button onclick="submitFinal()">Vollenden</button>
  </div>

  <!-- Szenen unver√§ndert -->
  <!-- (A-Frame Kapitel bleiben wie im Original; aus Platzgr√ºnden nicht erneut kommentiert) -->
  <!-- BEGINN SZENE -->
  <a-scene vr-mode-ui="enabled: true">
    <!-- Kapitel 1 -->
    <a-entity id="chapter1" visible="true">
      <a-sky color="#f5f5f5"></a-sky>
      <a-plane position="0 0 0" rotation="-90 0 0" width="50" height="50" color="#fafafa"></a-plane>
      <a-light type="ambient" color="#fff" intensity="0.9"></a-light>
      <a-text value="A" position="-2 2 -4" color="#ddd" scale="3 3 3" class="fading-letter" animation="property:position;to:-2 2.3 -4;dir:alternate;loop:true;dur:2000"></a-text>
      <a-text value="U" position="0 2.5 -5" color="#ddd" scale="3 3 3" class="fading-letter" animation="property:position;to:0 2.8 -5;dir:alternate;loop:true;dur:2500"></a-text>
      <a-text value="T" position="2 1.8 -4" color="#ddd" scale="3 3 3" class="fading-letter" animation="property:position;to:2 2.1 -4;dir:alternate;loop:true;dur:1800"></a-text>
      <a-text value="O" position="-1 3 -6" color="#ddd" scale="3 3 3" class="fading-letter" animation="property:position;to:-1 3.3 -6;dir:alternate;loop:true;dur:2200"></a-text>
      <a-text value="R" position="1.5 2.2 -5" color="#ddd" scale="3 3 3" class="fading-letter" animation="property:position;to:1.5 2.5 -5;dir:alternate;loop:true;dur:1900"></a-text>
      <a-box position="0 0.4 -3" width="1.5" height="0.8" depth="0.8" color="#8B4513"></a-box>
      <a-plane position="0 0.81 -3" rotation="-90 0 0" width="1" height="0.6" color="#fff"></a-plane>
      <a-text value="..." position="0 0.82 -3" rotation="-90 0 0" color="#ccc" scale="0.5 0.5 0.5" align="center"></a-text>
      <a-box id="portal1" class="portal" position="0 1.5 -12" width="3" height="3" depth="0.5" color="#333"></a-box>
      <a-text id="portal1-text" value="Warte..." position="0 1.5 -11.7" color="#666" align="center"></a-text>
    </a-entity>

    <!-- Kapitel 2 -->
    <a-entity id="chapter2" visible="false">
      <a-sky color="#1a0a0a"></a-sky>
      <a-plane position="0 0 0" rotation="-90 0 0" width="8" height="80" color="#0d0d0d"></a-plane>
      <a-light type="ambient" color="#220000" intensity="0.3"></a-light>
      <a-plane position="0 4.5 -20" rotation="90 0 0" width="8" height="80" color="#000000"></a-plane>
      <a-light type="point" position="0 2 -20" color="#ff0000" intensity="0.3" animation="property:intensity;from:0.05;to:1.2;dur:120;dir:alternate;loop:true;easing:linear"></a-light>
      <a-light type="point" position="-2 2.5 -10" color="#ff0000" intensity="0.2" animation="property:intensity;from:0.02;to:1.0;dur:90;dir:alternate;loop:true;easing:linear;delay:40"></a-light>
      <a-light type="point" position="2 2.5 -30" color="#ff0000" intensity="0.25" animation="property:intensity;from:0.03;to:1.1;dur:100;dir:alternate;loop:true;easing:linear;delay:60"></a-light>
      <a-light type="point" position="0 3 -40" color="#ff0000" intensity="0.2" animation="property:intensity;from:0.05;to:0.95;dur:110;dir:alternate;loop:true;easing:linear;delay:80"></a-light>
      <a-box position="-3 2 -20" width="0.3" height="5" depth="50" color="#1a0505"></a-box>
      <a-box position="3 2 -20" width="0.3" height="5" depth="50" color="#1a0505"></a-box>
      
      <!-- ORIGINAL TEXTE -->
      <a-text value="Das ist nicht gut genug." position="-2.7 2 -8" rotation="0 90 0" color="#550000" scale="0.7 0.7 0.7"></a-text>
      <a-text value="Wer will das lesen?" position="2.7 1.5 -14" rotation="0 -90 0" color="#550000" scale="0.7 0.7 0.7"></a-text>
      <a-text value="Das wurde schon geschrieben." position="-2.7 2.5 -20" rotation="0 90 0" color="#550000" scale="0.6 0.6 0.6"></a-text>
      <a-text value="Du bist kein:e echte:r Autor:in." position="2.7 2 -26" rotation="0 -90 0" color="#550000" scale="0.7 0.7 0.7"></a-text>
      <a-text value="Gib auf." position="-2.7 1.8 -32" rotation="0 90 0" color="#660000" scale="0.9 0.9 0.9"></a-text>
      <a-text value="Die anderen sind besser." position="2.7 2.3 -38" rotation="0 -90 0" color="#550000" scale="0.6 0.6 0.6"></a-text>
      
      <!-- NEUE ZWEIFEL - LINKE WAND -->
      <a-text value="Warum versuchst du es?" position="-2.7 3.2 -5" rotation="0 90 0" color="#770000" scale="0.5 0.5 0.5" font-family="serif"></a-text>
      <a-text value="Zu langsam." position="-2.7 0.8 -12" rotation="0 90 0" color="#660000" scale="1.2 1.2 1.2"></a-text>
      <a-text value="Deine Worte sind leer" position="-2.7 3.8 -18" rotation="0 90 0" color="#550000" scale="0.4 0.4 0.4"></a-text>
      <a-text value="BEDEUTUNGSLOS" position="-2.7 1.2 -24" rotation="0 90 0" color="#770000" scale="0.65 0.65 0.65" font-family="monospace"></a-text>
      <a-text value="Vergeben & verloren" position="-2.7 2.8 -28" rotation="0 90 0" color="#550000" scale="0.55 0.55 0.55"></a-text>
      <a-text value="Das hat niemand gefragt" position="-2.7 0.5 -35" rotation="0 90 0" color="#660000" scale="0.6 0.6 0.6"></a-text>
      <a-text value="Wertlos" position="-2.7 3.5 -42" rotation="0 90 0" color="#880000" scale="1.1 1.1 1.1" font-family="monospace"></a-text>
      <a-text value="Sie lachen ueber dich" position="-2.7 1.5 -48" rotation="0 90 0" color="#550000" scale="0.5 0.5 0.5"></a-text>
      
      <!-- NEUE ZWEIFEL - RECHTE WAND -->
      <a-text value="Falsch. Alles falsch." position="2.7 3.5 -7" rotation="0 -90 0" color="#770000" scale="0.6 0.6 0.6"></a-text>
      <a-text value="UNMOEGLICH" position="2.7 1.2 -11" rotation="0 -90 0" color="#660000" scale="1.3 1.3 1.3" font-family="monospace"></a-text>
      <a-text value="Deine Stimme ist zu leise" position="2.7 3.1 -15" rotation="0 -90 0" color="#550000" scale="0.4 0.4 0.4"></a-text>
      <a-text value="Plagiat" position="2.7 0.6 -22" rotation="0 -90 0" color="#880000" scale="0.95 0.95 0.95"></a-text>
      <a-text value="Nicht authentisch genug" position="2.7 2.9 -29" rotation="0 -90 0" color="#550000" scale="0.5 0.5 0.5"></a-text>
      <a-text value="VERSAGEN" position="2.7 1.8 -33" rotation="0 -90 0" color="#770000" scale="0.75 0.75 0.75" font-family="monospace"></a-text>
      <a-text value="Du wirst es nie schaffen" position="2.7 3.3 -40" rotation="0 -90 0" color="#550000" scale="0.55 0.55 0.55"></a-text>
      <a-text value="AUFGEBEN" position="2.7 0.9 -45" rotation="0 -90 0" color="#990000" scale="1.0 1.0 1.0" font-family="monospace"></a-text>
      
      <!-- EXTRA TEXTE - VERSCHIEDENE GR√ñSSEN & POSITIONEN -->
      <a-text value="Nicht genug" position="-1.5 1.2 -16" color="#660000" scale="0.45 0.45 0.45"></a-text>
      <a-text value="Sinn-los" position="1.8 3.2 -19" color="#770000" scale="0.7 0.7 0.7"></a-text>
      <a-text value="..." position="0 0.4 -25" color="#550000" scale="2.0 2.0 2.0"></a-text>
      <a-text value="Warum weitermachen?" position="-0.5 2.5 -30" color="#550000" scale="0.5 0.5 0.5"></a-text>
      <a-text value="LEERE" position="1.2 1.8 -37" color="#880000" scale="1.15 1.15 1.15" font-family="monospace"></a-text>
      <a-text value="Hoffnungslos" position="-1.8 3.6 -44" color="#550000" scale="0.55 0.55 0.55"></a-text>
      <a-text value="Ende?" position="0.8 0.3 -50" color="#770000" scale="0.8 0.8 0.8"></a-text>
      
      <a-box id="portal2" class="portal" position="0 1.5 -45" width="3" height="3" depth="0.5" color="#2ecc71" material="emissive:#2ecc71;emissiveIntensity:0.3"></a-box>
      <a-text value="‚Üí Weiter" position="0 1.5 -44.7" color="#fff" align="center"></a-text>
    </a-entity>

    <!-- Kapitel 3 -->
    <a-entity id="chapter3" visible="false">
      <a-sky color="#0a0a0a"></a-sky>
      <a-plane position="0 0 0" rotation="-90 0 0" width="40" height="60" color="#0d0d15"></a-plane>
      <a-light type="ambient" color="#112" intensity="0.4"></a-light>
      <a-light type="point" position="0 3 -15" color="#9b59b6" intensity="0.4"></a-light>
      <a-plane position="0 0.01 -3" rotation="-90 0 0" width="0.3" height="6" color="#2ecc71" material="emissive:#2ecc71;emissiveIntensity:0.5"></a-plane>
      <a-box position="-6 1.5 -15" width="0.2" height="3" depth="30" color="#f5f5dc" material="opacity:0.8"></a-box>
      <a-box position="6 1.5 -15" width="0.2" height="3" depth="30" color="#f5f5dc" material="opacity:0.8"></a-box>
      <a-text value="Waehle deinen Anfang" position="0 3 -6" color="#9b59b6" align="center" scale="0.8 0.8 0.8"></a-text>
      <a-box id="path-left" position="-3 0.6 -10" width="2.5" height="1.2" depth="2.5" color="#3498db" class="path-choice"></a-box>
      <a-text value="'Es war einmal...'" position="-3 1.5 -10" color="#fff" align="center" scale="0.4 0.4 0.4"></a-text>
      <a-box id="path-middle" position="0 0.6 -10" width="2.5" height="1.2" depth="2.5" color="#9b59b6" class="path-choice"></a-box>
      <a-text value="'Ich erinnere mich...'" position="0 1.5 -10" color="#fff" align="center" scale="0.4 0.4 0.4"></a-text>
      <a-box id="path-right" position="3 0.6 -10" width="2.5" height="1.2" depth="2.5" color="#e67e22" class="path-choice"></a-box>
      <a-text value="'Niemand wusste...'" position="3 1.5 -10" color="#fff" align="center" scale="0.4 0.4 0.4"></a-text>
      <a-text id="deadend-text" value="" position="0 2.5 -18" color="#e74c3c" align="center" visible="false" scale="0.7 0.7 0.7"></a-text>
      <a-box id="portal3" class="portal" position="0 1.5 -25" width="3" height="3" depth="0.5" color="#333"></a-box>
      <a-text id="portal3-text" value="Waehle zuerst..." position="0 1.5 -24.7" color="#666" align="center" scale="0.6 0.6 0.6"></a-text>
    </a-entity>

    <!-- Kapitel 4 -->
    <a-entity id="chapter4" visible="false">
      <a-sky color="#050510"></a-sky>
      <a-plane position="0 0 0" rotation="-90 0 0" width="30" height="40" color="#080815"></a-plane>
      <!-- Neon Ambient -->
      <a-light type="ambient" color="#222244" intensity="0.35"></a-light>

      <!-- Synth Puls Lights -->
      <a-light type="point" position="0 3 -10" color="#ff00ff" intensity="0.6"
               animation__c="property:color;dir:alternate;loop:true;dur:1400;from:#ff00ff;to:#00ffff"
               animation__i="property:intensity;dir:alternate;loop:true;dur:900;from:0.3;to:1.1"></a-light>

      <a-light type="point" position="-4 2.5 -11" color="#00ffff" intensity="0.7"
               animation__c="property:color;dir:alternate;loop:true;dur:1600;from:#00ffff;to:#ffff00"
               animation__i="property:intensity;dir:alternate;loop:true;dur:1200;from:0.4;to:1.0"></a-light>

      <a-light type="point" position="4 2.5 -9" color="#ffff00" intensity="0.7"
               animation__c="property:color;dir:alternate;loop:true;dur:1800;from:#ffff00;to:#ff0066"
               animation__i="property:intensity;dir:alternate;loop:true;dur:1000;from:0.4;to:1.15"></a-light>

      <a-light type="point" position="0 1.2 -6" color="#ff0066" intensity="0.5"
               animation__c="property:color;dir:alternate;loop:true;dur:1500;from:#ff0066;to:#00ff99"
               animation__i="property:intensity;dir:alternate;loop:true;dur:800;from:0.25;to:0.9"></a-light>

      <!-- Rotierender Light Ring f√ºr 80er Flair -->
      <a-entity position="0 2.8 -10" rotation="0 0 0" animation="property:rotation;to:0 360 0;loop:true;dur:6000;easing:linear">
        <a-light type="spot" position="0 0 3" angle="25" color="#00ffff" intensity="0.9"
                 animation__c="property:color;dir:alternate;loop:true;dur:1700;from:#00ffff;to:#ff00ff"
                 animation__i="property:intensity;dir:alternate;loop:true;dur:1300;from:0.4;to:1.2"></a-light>
        <a-light type="spot" position="3 0 0" angle="25" color="#ff00ff" intensity="0.9"
                 animation__c="property:color;dir:alternate;loop:true;dur:1700;from:#ff00ff;to:#ffff00"
                 animation__i="property:intensity;dir:alternate;loop:true;dur:1100;from:0.5;to:1.3"></a-light>
        <a-light type="spot" position="-3 0 0" angle="25" color="#ffff00" intensity="0.9"
                 animation__c="property:color;dir:alternate;loop:true;dur:1700;from:#ffff00;to:#00ff99"
                 animation__i="property:intensity;dir:alternate;loop:true;dur:1000;from:0.5;to:1.25"></a-light>
        <a-light type="spot" position="0 0 -3" angle="25" color="#00ff99" intensity="0.9"
                 animation__c="property:color;dir:alternate;loop:true;dur:1700;from:#00ff99;to:#ff0066"
                 animation__i="property:intensity;dir:alternate;loop:true;dur:1200;from:0.5;to:1.25"></a-light>
      </a-entity>

      <a-cylinder position="0 1.5 -10" radius="2.5" height="3" color="#111" material="metalness:0.8"></a-cylinder>

      <!-- Bestehende Torus behalten, Farben leicht neon -->
      <a-torus position="0 3.5 -10" radius="3" radius-tubular="0.1" color="#00ffff"
               material="emissive:#00ffff;emissiveIntensity:0.7"
               animation="property:rotation;to:0 360 0;loop:true;dur:3000;easing:linear"></a-torus>

      <a-torus position="0 3.5 -10" radius="2.2" radius-tubular="0.05" color="#ff00ff"
               material="emissive:#ff00ff;emissiveIntensity:0.7"
               animation="property:rotation;to:0 -360 0;loop:true;dur:2000;easing:linear"></a-torus>

      <a-entity position="0 0.01 -5">
        <a-plane position="0 0 0" rotation="-90 0 0" width="0.2" height="1.5" color="#00ffff" material="emissive:#00ffff;emissiveIntensity:0.8"></a-plane>
        <a-plane position="0 0 0" rotation="-90 0 0" width="1.5" height="0.2" color="#ff00ff" material="emissive:#ff00ff;emissiveIntensity:0.8"></a-plane>
      </a-entity>

      <a-box id="ai-terminal" position="0 1.2 -6" width="1.8" height="1.2" depth="0.4" color="#222"
             class="interact-ai"
             material="color:#222;emissive:#ff00ff;emissiveIntensity:0.4"></a-box>
      <a-text value="[ AKTIVIEREN ]" position="0 1.2 -5.79" color="#00ffff" align="center" scale="0.35 0.35 0.35"></a-text>

      <a-text value="EFFIZIENZ" position="-5 3 -12" color="#00ffff" scale="0.5 0.5 0.5" opacity="0.5"
              animation="property:color;dir:alternate;loop:true;dur:1600;from:#00ffff;to:#ff00ff"></a-text>
      <a-text value="PERFEKTION" position="5 2.5 -11" color="#ff00ff" scale="0.5 0.5 0.5" opacity="0.5"
              animation="property:color;dir:alternate;loop:true;dur:1800;from:#ff00ff;to:#ffff00"></a-text>
      <a-text value="SCHNELLER" position="4 3.8 -13" color="#ffff00" scale="0.5 0.5 0.5" opacity="0.5"
              animation="property:color;dir:alternate;loop:true;dur:1500;from:#ffff00;to:#00ff99"></a-text>

      <a-box position="6 0.4 -10" width="1" height="0.8" depth="0.6" color="#8B4513"></a-box>
      <a-plane position="6 0.81 -10" rotation="-90 0 0" width="0.6" height="0.4" color="#fff"></a-plane>
      <a-text value="Dein Platz" position="6 1.6 -10" color="#666" align="center" scale="0.35 0.35 0.35"></a-text>

      <a-box id="portal4" class="portal" position="0 1.5 -18" width="3" height="3" depth="0.5" color="#333"></a-box>
      <a-text id="portal4-text" value="Warte..." position="0 1.5 -17.7" color="#666" align="center"></a-text>
    </a-entity>

    <!-- Kapitel 5 -->
    <a-entity id="chapter5" visible="false">
      <a-sky id="sky5" src="horror2.jpg"></a-sky>
      
      <!-- Lichtstimmung √§hnlich Raum 2 (angepasst) -->
      <a-light type="ambient" color="#220000" intensity="0.25"></a-light>
      <a-light type="point" position="0 2 -8" color="#aa3333" intensity="0.3" animation="property:intensity;from:0.05;to:0.8;dur:150;dir:alternate;loop:true;easing:linear"></a-light>
      <a-light type="point" position="-4 2.5 -6" color="#cc4444" intensity="0.25" animation="property:intensity;from:0.03;to:0.7;dur:120;dir:alternate;loop:true;easing:linear;delay:30"></a-light>
      <a-light type="point" position="4 2.5 -10" color="#993333" intensity="0.3" animation="property:intensity;from:0.04;to:0.75;dur:140;dir:alternate;loop:true;easing:linear;delay:50"></a-light>
      <a-light type="point" position="0 3.5 -12" color="#bb2222" intensity="0.25" animation="property:intensity;from:0.05;to:0.7;dur:130;dir:alternate;loop:true;easing:linear;delay:70"></a-light>
      
      <!-- Neon-Reifen (Torus) im Stil von Raum 4 -->
      <a-torus position="-3 3.5 -9" radius="1.2" radius-tubular="0.08" color="#00ffff"
               material="emissive:#00ffff;emissiveIntensity:0.8"
               animation="property:rotation;to:360 0 0;loop:true;dur:2500;easing:linear"></a-torus>
      
      <a-torus position="4 2.8 -11" radius="0.9" radius-tubular="0.06" color="#ff00ff"
               material="emissive:#ff00ff;emissiveIntensity:0.8"
               animation="property:rotation;to:0 360 0;loop:true;dur:3000;easing:linear"></a-torus>
      
      <a-torus position="0 4 -7" radius="1.5" radius-tubular="0.1" color="#ffff00"
               material="emissive:#ffff00;emissiveIntensity:0.7"
               animation="property:rotation;to:0 0 360;loop:true;dur:2800;easing:linear"></a-torus>
      
      <a-torus position="-5 2.2 -12" radius="1.0" radius-tubular="0.07" color="#ff0066"
               material="emissive:#ff0066;emissiveIntensity:0.8"
               animation="property:rotation;to:180 360 180;loop:true;dur:3200;easing:linear"></a-torus>
      
      <a-torus position="2.5 3.2 -6" radius="0.8" radius-tubular="0.05" color="#00ff99"
               material="emissive:#00ff99;emissiveIntensity:0.9"
               animation="property:rotation;to:360 180 0;loop:true;dur:2600;easing:linear"></a-torus>
      
      <a-torus position="-1.5 4.5 -13" radius="1.1" radius-tubular="0.08" color="#ff6600"
               material="emissive:#ff6600;emissiveIntensity:0.75"
               animation="property:rotation;to:0 360 360;loop:true;dur:3500;easing:linear"></a-torus>
  
      <!-- Schwebende leere wei√üe Seiten -->
      <a-plane position="-5 2.5 -7" width="0.6" height="0.8" color="#ffffff" opacity="0.9" rotation="20 45 10" animation="property:position;to:-5 3.2 -7;dir:alternate;loop:true;dur:3200;easing:easeInOutSine" animation__rot="property:rotation;to:30 60 -5;dir:alternate;loop:true;dur:4000;easing:easeInOutSine"></a-plane>
      <a-plane position="4 3.5 -9" width="0.5" height="0.7" color="#ffffff" opacity="0.85" rotation="-15 -30 20" animation="property:position;to:4 4.1 -9;dir:alternate;loop:true;dur:2800;easing:easeInOutSine" animation__rot="property:rotation;to:-25 -45 10;dir:alternate;loop:true;dur:3500;easing:easeInOutSine"></a-plane>
      <a-plane position="-2 4 -11" width="0.7" height="0.9" color="#ffffff" opacity="0.9" rotation="35 20 -15" animation="property:position;to:-2 4.6 -11;dir:alternate;loop:true;dur:3000;easing:easeInOutSine" animation__rot="property:rotation;to:45 35 -25;dir:alternate;loop:true;dur:3800;easing:easeInOutSine"></a-plane>
      <a-plane position="3 2 -6" width="0.55" height="0.75" color="#ffffff" opacity="0.88" rotation="-20 60 25" animation="property:position;to:3 2.7 -6;dir:alternate;loop:true;dur:2600;easing:easeInOutSine" animation__rot="property:rotation;to:-30 75 15;dir:alternate;loop:true;dur:3200;easing:easeInOutSine"></a-plane>
      <a-plane position="0 3.2 -5" width="0.65" height="0.85" color="#ffffff" opacity="0.92" rotation="10 -15 30" animation="property:position;to:0 3.8 -5;dir:alternate;loop:true;dur:2900;easing:easeInOutSine" animation__rot="property:rotation;to:20 -25 40;dir:alternate;loop:true;dur:3600;easing:easeInOutSine"></a-plane>
      <a-plane position="-3.5 2.8 -10" width="0.6" height="0.8" color="#ffffff" opacity="0.87" rotation="25 40 -20" animation="property:position;to:-3.5 3.4 -10;dir:alternate;loop:true;dur:3100;easing:easeInOutSine" animation__rot="property:rotation;to:35 55 -30;dir:alternate;loop:true;dur:3700;easing:easeInOutSine"></a-plane>
      <a-plane position="5 2.2 -12" width="0.55" height="0.75" color="#ffffff" opacity="0.9" rotation="-30 -50 15" animation="property:position;to:5 2.9 -12;dir:alternate;loop:true;dur:2700;easing:easeInOutSine" animation__rot="property:rotation;to:-40 -65 5;dir:alternate;loop:true;dur:3400;easing:easeInOutSine"></a-plane>
      <a-plane position="-1 3.6 -8" width="0.6" height="0.8" color="#ffffff" opacity="0.91" rotation="15 25 -10" animation="property:position;to:-1 4.2 -8;dir:alternate;loop:true;dur:2850;easing:easeInOutSine" animation__rot="property:rotation;to:25 40 -20;dir:alternate;loop:true;dur:3550;easing:easeInOutSine"></a-plane>
      <a-plane position="2 4.2 -13" width="0.65" height="0.85" color="#ffffff" opacity="0.88" rotation="-25 35 20" animation="property:position;to:2 4.8 -13;dir:alternate;loop:true;dur:3050;easing:easeInOutSine" animation__rot="property:rotation;to:-35 50 30;dir:alternate;loop:true;dur:3750;easing:easeInOutSine"></a-plane>
      <a-plane position="-4.5 3.8 -14" width="0.6" height="0.8" color="#ffffff" opacity="0.9" rotation="30 -20 -25" animation="property:position;to:-4.5 4.4 -14;dir:alternate;loop:true;dur:2950;easing:easeInOutSine" animation__rot="property:rotation;to:40 -35 -35;dir:alternate;loop:true;dur:3650;easing:easeInOutSine"></a-plane>
      <a-plane position="1.5 1.8 -7" width="0.55" height="0.75" color="#ffffff" opacity="0.86" rotation="20 50 15" animation="property:position;to:1.5 2.5 -7;dir:alternate;loop:true;dur:2750;easing:easeInOutSine" animation__rot="property:rotation;to:30 65 25;dir:alternate;loop:true;dur:3450;easing:easeInOutSine"></a-plane>
      <a-plane position="-6 3 -9" width="0.7" height="0.9" color="#ffffff" opacity="0.89" rotation="-10 -40 30" animation="property:position;to:-6 3.6 -9;dir:alternate;loop:true;dur:3150;easing:easeInOutSine" animation__rot="property:rotation;to:-20 -55 40;dir:alternate;loop:true;dur:3850;easing:easeInOutSine"></a-plane>
      
      <!-- Schwebende Fragen -->
      <a-text value="Wofuer entscheidest du dich?" position="-3 3 -5" color="#aa5555" scale="0.6 0.6 0.6" opacity="0.7" align="center" animation="property:position;to:-3 3.4 -5;dir:alternate;loop:true;dur:2200;easing:easeInOutSine"></a-text>
      <a-text value="Bist du dir sicher?" position="3 2.5 -7" color="#bb4444" scale="0.6 0.6 0.6" opacity="0.7" align="center" animation="property:position;to:3 2.9 -7;dir:alternate;loop:true;dur:2500;easing:easeInOutSine"></a-text>
      <a-text value="Was ist deine Stimme?" position="-2 3.5 -9" color="#993333" scale="0.5 0.5 0.5" opacity="0.6" align="center" animation="property:position;to:-2 3.9 -9;dir:alternate;loop:true;dur:2800;easing:easeInOutSine"></a-text>
      <a-text value="Maschine oder Mensch?" position="2.5 3.2 -11" color="#cc5555" scale="0.55 0.55 0.55" opacity="0.65" align="center" animation="property:position;to:2.5 3.6 -11;dir:alternate;loop:true;dur:2400;easing:easeInOutSine"></a-text>
      <a-text value="Wer schreibt wirklich?" position="-4 2.8 -8" color="#aa4444" scale="0.5 0.5 0.5" opacity="0.6" align="center" animation="property:position;to:-4 3.2 -8;dir:alternate;loop:true;dur:2600;easing:easeInOutSine"></a-text>
      <a-text value="Kannst du noch waehlen?" position="4 3.8 -6" color="#994444" scale="0.55 0.55 0.55" opacity="0.65" align="center" animation="property:position;to:4 4.2 -6;dir:alternate;loop:true;dur:2300;easing:easeInOutSine"></a-text>
      <a-text value="Was bleibt von dir?" position="0 4 -10" color="#bb3333" scale="0.6 0.6 0.6" opacity="0.7" align="center" animation="property:position;to:0 4.4 -10;dir:alternate;loop:true;dur:2700;easing:easeInOutSine"></a-text>
      
      <!-- Bestehende Elemente -->
      <a-torus position="-4 2 -8" radius="0.7" radius-tubular="0.04" color="#4ecdc4" opacity="0.35" animation="property:rotation;to:0 360 0;loop:true;dur:4000"></a-torus>
      <a-torus position="4 2.5 -7" radius="0.5" radius-tubular="0.04" color="#e94560" opacity="0.35" animation="property:rotation;to:0 -360 0;loop:true;dur:3000"></a-torus>
      <a-text value="?" position="-2 4 -9" color="#555" scale="1.5 1.5 1.5" animation="property:position;to:-2 4.3 -9;dir:alternate;loop:true;dur:2500"></a-text>
      <a-text value="?" position="2.5 3.5 -8" color="#555" scale="1.5 1.5 1.5" animation="property:position;to:2.5 3.8 -8;dir:alternate;loop:true;dur:2200"></a-text>
      <a-cylinder position="0 0.3 -8" radius="1.8" height="0.6" color="#000000" material="metalness:0.4"></a-cylinder>
      <a-box id="final-desk" position="0 0.85 -8" width="1.2" height="0.5" depth="0.7" color="#8b4513" class="interact-final"></a-box>
      <a-text value="SCHREIB" position="0 1.6 -8" color="#f39c12" align="center" scale="0.5 0.5 0.5" animation="property:scale;to:0.55 0.55 0.55;dir:alternate;loop:true;dur:1000"></a-text>
      <a-box id="exit-door" class="portal" position="0 2 -15" width="3" height="4" depth="0.3" color="#444"></a-box>
      <a-text id="exit-text" value="AUSGANG" position="0 2 -14.8" color="#777" align="center"></a-text>
    </a-entity>

    <!-- Kapitel 6 -->
    <a-entity id="chapter6" visible="false">
      <a-sky color="#f6e7c7"></a-sky>
      <a-light type="ambient" color="#ffecd2" intensity="0.7"></a-light>
      <a-light type="point" position="-8 3 -8" color="#ffd89b" intensity="1" distance="15"></a-light>
      <a-light type="point" position="8 3 -8" color="#ffd89b" intensity="1" distance="15"></a-light>
      <a-light type="point" position="0 3 0" color="#ffe4b5" intensity="0.8" distance="12"></a-light>
    </a-entity>

    <!-- VR Rig mit Controller & Blicksteuerung -->
    <a-entity id="rig" position="0 0 4" thumbstick-movement="speed: 3">
      <a-camera id="camera" position="0 1.6 0"
                look-controls="pointerLockEnabled: false"
                wasd-controls="enabled: true; acceleration: 30"
                cursor="rayOrigin: mouse; fuse: false"
                raycaster="objects: .interact-ai, .interact-final, .path-choice, .portal; far: 20">
        <!-- Cursor f√ºr VR (zeigt wohin man schaut) -->
        <a-entity cursor="fuse: true; fuseTimeout: 1500"
                  position="0 0 -1"
                  geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                  material="color: #4ecdc4; shader: flat"
                  animation__click="property: scale; startEvents: click; easing: easeInCubic; dur: 150; from: 0.1 0.1 0.1; to: 1 1 1"
                  animation__fusing="property: scale; startEvents: fusing; easing: easeInCubic; dur: 1500; from: 1 1 1; to: 0.1 0.1 0.1"
                  animation__mouseleave="property: scale; startEvents: mouseleave; easing: easeInCubic; dur: 500; to: 1 1 1"
                  raycaster="objects: .interact-ai, .interact-final, .path-choice, .portal; far: 20">
        </a-entity>
      </a-camera>
      
      <!-- Linker Controller (Bewegung) - Linie nur in VR sichtbar -->
      <a-entity id="leftHand"
                oculus-touch-controls="hand: left"
                vive-controls="hand: left"
                windows-motion-controls="hand: left"
                raycaster="objects: .interact-ai, .interact-final, .path-choice, .portal; far: 15; showLine: false">
      </a-entity>
      
      <!-- Rechter Controller (Interaktion) - Linie nur in VR sichtbar -->
      <a-entity id="rightHand"
                oculus-touch-controls="hand: right"
                vive-controls="hand: right"
                windows-motion-controls="hand: right"
                raycaster="objects: .interact-ai, .interact-final, .path-choice, .portal; far: 15; showLine: false">
      </a-entity>
    </a-entity>

  </a-scene>

  <script>
    let currentChapter = 1;
    let portal1Active = false;
    let pathChosen = false;
    let aiUsed = false;
    let gameStarted = false;
    let listenersRegistered = false; // NEU

    const titles = [
      ['Kapitel 1: Die Leere','Wo Saetze noch nicht existieren'],
      ['Kapitel 2: Die Stimmen','Die Kritiker:innen erwachen'],
      ['Kapitel 3: Die Qual der Wahl','Jede Entscheidung formt die Geschichte. Und schliesst andere aus.'],
      ['Kapitel 4: Die Maschine','Schneller. Besser? Aber wessen Worte?'],
      ['Kapitel 5: Die Synthese','Trotz allem ‚Äì Schreiben'],
      ['Kapitel 6: Die Bibliothek','W√§rme, Staub und Geschichten']
    ];
    
    const voices = ["Das ist nicht gut genug.","Wer will das lesen?","Gib auf.","Die KI macht es besser.","Du bist zu langsam.","Das hat keinen Wert.","Warum versuchst du es noch?","Niemand wartet auf deine Worte."];
    
    const aiTexts = {
      'einsamkeit': "Die Einsamkeit ist ein stiller Raum, in dem die Gedanken widerhallen wie Schritte in einer leeren Kathedrale. Sie ist nicht die Abwesenheit von Menschen, sondern die Anwesenheit des ungefilterten Selbst ‚Äì roh, ungesch√∂nt, wartend.",
      'liebe': "Liebe ist der Mut, sich einem anderen Menschen zu zeigen, bevor man sich selbst vollst√§ndig kennt. Sie ist das Wagnis, verletzt zu werden, und die Hoffnung, dass dieses Wagnis belohnt wird.",
      'verg√§nglichkeit': "Alles vergeht. Die Bl√ºte welkt, der Stein verwittert, selbst Sterne erl√∂schen. Und doch liegt in dieser Verg√§nglichkeit eine seltsame Sch√∂nheit ‚Äì sie macht jeden Moment kostbar.",
      'angst': "Angst ist der Schatten, der w√§chst, je mehr wir vor ihm fliehen. Sie fl√ºstert von Gefahren, die vielleicht nie eintreten, und l√§hmt uns mit Bildern dessen, was sein k√∂nnte.",
      'hoffnung': "Hoffnung ist ein Licht, das brennt, auch wenn alle Logik dagegen spricht. Sie ist der Samen, der durch Beton bricht. Irrational, unvern√ºnftig ‚Äì und doch das Menschlichste.",
      'schmerz': "Schmerz ist die Sprache, die der K√∂rper spricht, wenn Worte versagen. Er ist Wahrheit ohne Filter, Authentizit√§t ohne Maske. In ihm offenbaren wir uns selbst.",
      'sch√∂nheit': "Sch√∂nheit ist nicht das Gegenteil von H√§sslichkeit. Sie ist die F√§higkeit, in der Bruchstelle des Schmerzes einen Riss zu sehen, durch den Licht f√§llt.",
      'tod': "Der Tod ist der einzige universelle Editor. Er streicht alles weg, was nicht wesentlich ist. Vielleicht lehrt er uns, was es bedeutet, wirklich zu leben.",
      'freiheit': "Freiheit ist nicht die Abwesenheit von Grenzen, sondern die F√§higkeit, innerhalb von Grenzen Entscheidungen zu treffen, die uns geh√∂ren. Sie ist das Gewicht der Verantwortung.",
      'einheit': "In der Einheit verlieren wir uns. In der Zersplitterung finden wir uns. Vielleicht ist die Wahrheit dazwischen ‚Äì im Bruch, im Echo, im Zwischenraum.",
      'stille': "Stille ist nicht das Fehlen von L√§rm. Sie ist das Gegenteil von Lautst√§rke ‚Äì eine Pr√§senz, die zuh√∂rt. In ihr werden wir zu uns selbst.",
      'zeit': "Zeit ist ein Erz√§hler, der nur r√ºckw√§rts spricht. Die Zukunft erfinden wir aus Hoffnung, die Vergangenheit aus Erinnerung. Die Gegenwart ist der d√ºnnste Moment zwischen beiden.",
      'verlust': "Verlust ist das Gegenteil von Besitz ‚Äì nicht weil wir etwas nicht mehr haben, sondern weil wir nun wissen, was es bedeutete, es zu haben. Verlust lehrt uns Gewicht.",
      'identit√§t': "Wer bin ich, wenn nicht die Summe meiner Widerspr√ºche? Ich bin das, was ich sage, und das, was ich nicht sagen kann. Ich bin das Scheitern, eine andere Person zu sein.",
      'vertrauen': "Vertrauen ist das Risiko, nicht besch√ºtzt zu werden. Es ist die Entscheidung, verletzlich zu sein, obwohl verletzlich Schmerz bedeutet.",
      'erinnerung': "Erinnerung ist kein Archiv der Wahrheit. Sie ist eine Geschichte, die wir uns selbst erz√§hlen, um Sinn in das Chaos zu bringen. Jedes Mal, wenn wir sie erz√§hlen, ver√§ndern wir sie.",
      'kreativit√§t': "Kreativit√§t ist nicht die F√§higkeit, etwas Neues zu erfinden. Sie ist die F√§higkeit, die Welt auseinanderzunehmen und sie so wieder zusammenzusetzen, dass wir sie verstehen k√∂nnen.",
      'einfluss': "Einfluss ist die F√§higkeit, die Realit√§t eines anderen Menschen zu ver√§ndern. Mit dieser Kraft kommt eine Verantwortung, die die meisten von uns nicht anerkennen wollen.",
      'demut': "Demut ist nicht Schw√§che. Sie ist die Kraft, deine Grenzen zu erkennen und sie dennoch zu √ºberschreiten. Es ist die Weisheit, zu wissen, was du nicht weisst.",
      'ekstase': "Ekstase ist ein Zustand, in dem das Selbst sich selbst vergibt. In ihm entdecken wir, dass wir mehr sind als das, was wir dachten ‚Äì und gleichzeitig viel kleiner.",
      'wahrheit': "Wahrheit ist kein Ort, sondern ein Prozess. Sie offenbart sich in den Rissen zwischen Aussage und Stille, zwischen Sicherheit und Zweifel. Wer sie ganz erfasst, hat aufgeh√∂rt zu denken.",
      'schreiben': "Schreiben ist eine Flucht, die kein Entkommen ist. Es ist die Fixierung des Fl√ºchtigen, der Versuch, das Unsagbare in Form zu zwingen. Und doch: alles Gro√üe wurde aufgeschrieben.",
      'scheitern': "Scheitern ist nicht das Ende der Geschichte, sondern ihre echte Mitte. Es ist der Moment, in dem wir aufh√∂ren, die Rolle zu spielen, und anfangen, Mensch zu sein.",
      'schlaf': "Im Schlaf verlieren wir die Kontrolle. Die Tr√§ume schreiben ihre eigenen Geschichten, ohne unseren Willen zu fragen. Vielleicht ist dies die letzte Freiheit, die uns bleibt.",
      'rauschen': "Das Rauschen ist das Gegenteil des Wortes. Es ist die Wahrheit hinter der Sprache ‚Äì formlos, unendlich, unzensierbar. In ihm finden wir, was Worte nie erreichen k√∂nnen.",
      'farbe': "Farbe spricht, wenn Worte schweigen. Sie ist emotional, irrational, unkontrollierbar. Rot ist nicht nur Rot ‚Äì es ist Blut, Feuer, Leidenschaft, Gefahr und Liebe zugleich.",
      'leere': "Die Leere ist keine Abwesenheit. Sie ist Raum. Potential. Der Atem vor dem Satz. Manche f√ºrchten sie. Andere verlieren sich darin und finden sich selbst.",
      'echo': "Ein Echo kehrt zur√ºck, ver√§ndert. So funktioniert Kommunikation ‚Äì wir senden aus, erhalten zur√ºck, was wir nie ganz erkennen. Wir sprechen zu Spiegelbildern unserer selbst.",
      'wasser': "Wasser passt sich an. Es flie√üt um Hindernisse, nimmt jede Form an ‚Äì und bleibt doch selbst. Es ist das Symbol der Anpassung ohne Aufgabe der Essenz.",
      'feuer': "Feuer zerst√∂rt und erhellt zugleich. Es ist Transformation. Alles, was brennt, wird zu Asche, aber diese Asche ist Boden f√ºr Neues. Aus Ruinen w√§chst Leben.",
      'stimme': "Stimme ist das Prim√§re. Bevor Sprache war, war Klang. Jede Stimme tr√§gt Jahrtausende in sich ‚Äì Angst, Hoffnung, Schmerz, Ekstase. Deine Stimme ist deine Wahrheit.",
      'raum': "Raum ist nicht nur Geometrie. Er ist psychologisch, politisch, poetisch. Der Raum, den wir einnehmen, definiert, wer wir sind. Gr√∂√üer zu denken bedeutet, gr√∂√üeren Raum zu beanspruchen.",
      'dunkelheit': "Dunkelheit ist nicht Fehlen von Licht. Sie ist eigenst√§ndig. In ihr verschwinden die Illusionen der Klarheit. Manche f√ºrchten sie. Andere sehen hier klarer als je zuvor.",
      'grenze': "Grenzen definieren. Ohne Grenzen gibt es keine Form, keine Identit√§t. Und doch: die interessantesten Dinge passieren an den Grenzen, dort, wo zwei Welten sich ber√ºhren.",
      'bewegung': "Stillstand ist unm√∂glich. Alles bewegt sich ‚Äì die Erde, die Gedanken, die Gef√ºhle. Wer meint, still zu stehen, bewegt sich nur unbewusst. Erkennen ist: die Bewegung sehen.",
      'sprache': "Sprache ist eine Kr√ºcke und ein Fl√ºgel. Sie beschr√§nkt das Unbegrenzte und befreit das Gefangene. Mit Worten bauen wir Welten ‚Äì und zerst√∂ren sie auch.",
      'default': "In der Stille zwischen den Worten liegt mehr Bedeutung als in den Worten selbst. Der Text entsteht, formt sich ‚Äì aber zu wessen Geschichte? Die Maschine kennt alle Worte, doch kennt sie auch ihr Gewicht?"
    };

    const libraryWords = ['Gedanke','Traum','Gefuehl','Erinnerung','Seele','Geist','Bewusstsein','Ahnung','Stille','Echo','Hauch','Fluestern','Sehnsucht','Hoffnung','Wehmut','Zeitlosigkeit','Essenz','Praesenz','Stimmung','Atem','Resonanz','Moment','Leere','Raum','Tiefe','Frequenz','Rhythmus','Vibration','Energie','Schwingung'];

    // Audio Funktionen
    let redSexAudio = null, blackNoiseAudio = null, libraryAudio = null, schoenbergAudio = null, bleachAudio = null, locrianAudio = null, finaleAudio = null;
    
    function playRedSex() {
      try {
        if (!redSexAudio) {
          redSexAudio = new Audio('red_sex_cut.mp3');
          redSexAudio.loop = true;
          redSexAudio.volume = 0.6;
        }
        redSexAudio.currentTime = 0;
        redSexAudio.play().catch(()=>{});
      } catch {}
    }
    function stopRedSex(){ if(redSexAudio){ redSexAudio.pause(); redSexAudio.currentTime=0; } }

    function playBlackNoise() {
      try {
        if (!blackNoiseAudio) {
          blackNoiseAudio = new Audio('black_noise.mp3');
          blackNoiseAudio.loop = true;
          blackNoiseAudio.volume = 0.5;
        }
        blackNoiseAudio.currentTime = 0;
        blackNoiseAudio.play().catch(()=>{});
      } catch {}
    }
    function stopBlackNoise(){ if(blackNoiseAudio){ blackNoiseAudio.pause(); blackNoiseAudio.currentTime=0; } }

    function playLibraryMusic() {
      try {
        if (!libraryAudio) {
          libraryAudio = new Audio('its_happening.mp3');
          libraryAudio.loop = true;
          libraryAudio.volume = 0.6;
        }
        libraryAudio.currentTime = 0;
        libraryAudio.play().catch(()=>{});
      } catch {}
    }
    function stopLibraryMusic(){ if(libraryAudio){ libraryAudio.pause(); libraryAudio.currentTime=0; } }

    function playSchoenberg() {
      try {
        if (!schoenbergAudio) {
          schoenbergAudio = new Audio('schoenberg.mp3');
          schoenbergAudio.loop = true;
          schoenbergAudio.volume = 0.6;
        }
        schoenbergAudio.currentTime = 0;
        schoenbergAudio.play().catch(()=>{});
      } catch {}
    }
    function stopSchoenberg(){ if(schoenbergAudio){ schoenbergAudio.pause(); schoenbergAudio.currentTime=0; } }

    function playBleach(){
      try{
        if(!bleachAudio){
          bleachAudio = new Audio('bleach.mp3');
          bleachAudio.loop = true;
          bleachAudio.volume = 0.6;
        }
        bleachAudio.currentTime = 0;
        bleachAudio.play().catch(()=>{});
      }catch{}
    }
    function stopBleach(){ if(bleachAudio){ bleachAudio.pause(); bleachAudio.currentTime=0; } }

    function playLocrian(){
      try{
        if(!locrianAudio){
          locrianAudio = new Audio('locrian.mp3');
          locrianAudio.loop = true;
          locrianAudio.volume = 0.6;
        }
        locrianAudio.currentTime = 0;
        locrianAudio.play().catch(()=>{});
      }catch{}
    }
    function stopLocrian(){ if(locrianAudio){ locrianAudio.pause(); locrianAudio.currentTime=0; } }

    function playFinale(){
      try{
        if(!finaleAudio){
          finaleAudio = new Audio('finale.mp3');
          finaleAudio.loop = true;
          finaleAudio.volume = 0.6;
        }
        finaleAudio.currentTime = 0;
        finaleAudio.play().catch(()=>{});
      }catch{}
    }
    function stopFinale(){ if(finaleAudio){ finaleAudio.pause(); finaleAudio.currentTime=0; } }

    function stopAllAudio(){
      stopBlackNoise();
      stopRedSex();
      stopLibraryMusic();
      stopSchoenberg();
      stopLocrian();
      stopBleach();
      stopFinale();
    }

    function playChapterMusic(chapter){
      stopAllAudio();
      clearLibraryBooks();
      clearLibraryWords();
      clearVRVoices();  // ‚Üê NEU: Alte Stimmen l√∂schen
      
      if(chapter === 1){
        playBlackNoise();
      } else if(chapter === 2){
        playRedSex();
        showVoices();  // ‚Üê Erzeugt jetzt auch VR-Stimmen
      } else if(chapter === 3){
        playSchoenberg();
      } else if(chapter === 4){
        playLocrian();
      } else if(chapter === 5){
        playFinale();
        spawnVRVoices();  // ‚Üê Neue Stimmen in Raum 5
      } else if(chapter === 6){
        playLibraryMusic();
        spawnLibraryBooks(60);
        spawnLibraryWords();
      }
    }

    function showVoices() {
      // Nur f√ºr Raum 2!
      if(currentChapter !== 2) return;
      
      const voicesContainer = document.getElementById('voices');
      voicesContainer.style.display = 'block';
      
      // HTML Stimmen (f√ºr Desktop)
      voices.forEach((voice, idx) => {
        const voiceEl = document.createElement('div');
        voiceEl.className = 'voice';
        voiceEl.textContent = voice;
        voiceEl.style.left = Math.random() * 80 + '%';
        voiceEl.style.top = Math.random() * 60 + '%';
        voiceEl.style.animationDelay = (idx * 0.5) + 's';
        voicesContainer.appendChild(voiceEl);
      });
      
      // A-Frame Stimmen (f√ºr VR in Raum 2)
      spawnVRVoices();
    }

    function spawnVRVoices() {
      // Nur in Raum 2 oder 5!
      if(currentChapter !== 2 && currentChapter !== 5) return;
      
      // Entferne alte Stimmen
      const oldContainer = document.getElementById('vr-voices-container');
      if(oldContainer) oldContainer.remove();
      
      // Neue Container f√ºr VR-Stimmen
      let voicesEntity = document.createElement('a-entity');
      voicesEntity.id = 'vr-voices-container';
      
      voices.forEach((voice, idx) => {
        const voiceText = document.createElement('a-text');
        
        // Zuf√§llige Position um den Spieler herum
        const theta = (Math.random() * Math.PI * 2);
        const phi = Math.random() * Math.PI * 0.6 + 0.2;
        const r = 3 + Math.random() * 4;
        
        const x = Math.sin(phi) * Math.cos(theta) * r;
        const y = Math.cos(phi) * r + 1.5;
        const z = Math.sin(phi) * Math.sin(theta) * r;
        
        voiceText.setAttribute('value', voice);
        voiceText.setAttribute('position', `${x} ${y} ${z}`);
        voiceText.setAttribute('color', '#aa5555');
        voiceText.setAttribute('scale', '0.8 0.8 0.8');
        voiceText.setAttribute('align', 'center');
        voiceText.setAttribute('opacity', '0.8');
        
        const duration = 2000 + Math.random() * 2000;
        voiceText.setAttribute('animation__move', 
          `property:position;dir:alternate;loop:true;dur:${duration};` +
          `to:${x} ${y + 0.5} ${z};easing:easeInOutSine`);
        
        voiceText.setAttribute('animation__opacity',
          `property:opacity;dir:alternate;loop:true;dur:${800 + Math.random() * 600};` +
          `from:0.3;to:0.9;easing:linear`);
        
        voicesEntity.appendChild(voiceText);
      });
      
      // An aktuelles Kapitel anh√§ngen
      const chapter = document.getElementById('chapter' + currentChapter);
      if(chapter) {
        chapter.appendChild(voicesEntity);
      }
    }

    function clearVRVoices() {
      const container = document.getElementById('vr-voices-container');
      if(container) container.remove();
      
      // Auch HTML-Stimmen in Raum 2 l√∂schen
      const voicesContainer = document.getElementById('voices');
      if(voicesContainer) {
        voicesContainer.style.display = 'none';
        voicesContainer.innerHTML = '';
      }
    }

    const libraryBooksContainerId='library-books-container';
    function spawnLibraryBooks(count=40){
      let container=document.getElementById(libraryBooksContainerId);
      if(!container){
        container=document.createElement('a-entity');
        container.id=libraryBooksContainerId;
        document.getElementById('chapter6').appendChild(container);
      } else {
        clearLibraryBooks();
      }
      const colors=['#f6c6a6','#ffd89b','#d7f3e3','#c9d6ff','#f3d6f7','#ffe2e2','#e6f7d1','#f7f0c9'];
      for(let i=0;i<count;i++){
        const book=document.createElement('a-box');
        const w=(Math.random()*0.6)+0.2;
        const h=(Math.random()*1.2)+0.4;
        const d=(Math.random()*0.08)+0.04;
        const x=(Math.random()*20)-10;
        const y=(Math.random()*8)-2;
        const z=(Math.random()*20)-10;
        const color=colors[Math.floor(Math.random()*colors.length)];
        const rx=Math.random()*360;
        const ry=Math.random()*360;
        const rz=Math.random()*360;
        book.setAttribute('geometry',`primitive:box;width:${w};height:${h};depth:${d}`);
        book.setAttribute('material',`color:${color};metalness:0.1;roughness:0.7`);
        book.setAttribute('position',`${x} ${y} ${z}`);
        book.setAttribute('rotation',`${rx} ${ry} ${rz}`);
        book.className='library-book';
        const bobDur=Math.floor(Math.random()*3000)+2000;
        book.setAttribute('animation__bob',`property:position;dir:alternate;dur:${bobDur};to:${x} ${y+0.6} ${z};loop:true;easing:easeInOutSine`);
        const rotDur=Math.floor(Math.random()*6000)+4000;
        book.setAttribute('animation__rot',`property:rotation;to:${rx+360} ${ry+180} ${rz+90};dur:${rotDur};loop:true;easing:linear`);
        const scaleFactor=1+Math.random()*0.2;
        book.setAttribute('animation__scale',`property:scale;dir:alternate;dur:${Math.floor(Math.random()*2500)+1500};to:${scaleFactor} ${scaleFactor} ${scaleFactor};loop:true;easing:easeInOutSine`);
        container.appendChild(book);
      }
      for(let j=0;j<15;j++){
        const book=document.createElement('a-box');
        const w=(Math.random()*0.9)+0.3;
        const h=(Math.random()*1.5)+0.6;
        const d=(Math.random()*0.08)+0.04;
        const x=(Math.random()*12)-6;
        const y=(Math.random()*8)-2;
        const z=(Math.random()*12)-6;
        const color=colors[Math.floor(Math.random()*colors.length)];
        book.setAttribute('geometry',`primitive:box;width:${w};height:${h};depth:${d}`);
               book.setAttribute('material',`color:${color};metalness:0.05;roughness:0.9`);
        book.setAttribute('position',`${x} ${y} ${z}`);
        book.setAttribute('rotation',`${Math.random()*360} ${Math.random()*360} ${Math.random()*360}`);
        book.className='library-book';
        book.setAttribute('animation__bob',`property:position;dir:alternate;dur:${Math.floor(Math.random()*3500)+2500};to:${x} ${y+1.2} ${z};loop:true;easing:easeInOutSine`);
        container.appendChild(book);
      }
    }
    function clearLibraryBooks(){
      const c=document.getElementById(libraryBooksContainerId);
      if(c) c.remove();
    }

    const libraryWordsContainerId='library-words-container';
    function spawnLibraryWords(){
      let container=document.getElementById(libraryWordsContainerId);
      if(!container){
        container=document.createElement('a-entity');
        container.id=libraryWordsContainerId;
        document.getElementById('chapter6').appendChild(container);
      } else {
        container.innerHTML='';
      }
      libraryWords.forEach(word=>{
        const t=document.createElement('a-text');
        const x=(Math.random()-0.5)*25;
        const y=Math.random()*5+1;
        const z=(Math.random()-0.5)*25;
        const scale=Math.random()*1.5+0.8;
        const dur=Math.random()*2000+2000;
        t.setAttribute('value',word);
        t.setAttribute('position',`${x} ${y} ${z}`);
        t.setAttribute('color','#a8987a');
        t.setAttribute('scale',`${scale} ${scale} ${scale}`);
        t.setAttribute('align','center');
        t.setAttribute('opacity','0.7');
        t.setAttribute('animation',`property:position;to:${x} ${y+0.3} ${z};dir:alternate;loop:true;dur:${dur};easing:easeInOutSine`);
        container.appendChild(t);
      });
    }
    function clearLibraryWords(){
      const c=document.getElementById(libraryWordsContainerId);
      if(c) c.innerHTML='';
    }

    function activatePortal(n){
      try{
        const p=document.getElementById('portal'+n);
        const pt=document.getElementById('portal'+n+'-text');
        if(!p) return;
        p.setAttribute('color','#2ecc71');
        p.setAttribute('material','color:#2ecc71;emissive:#2ecc71;emissiveIntensity:0.6');
        if(pt){ 
          pt.setAttribute('value','‚Üí Weiter'); 
          pt.setAttribute('color','#ffffff'); 
        }
        console.log('Portal', n, 'aktiviert!');
      }catch(e){
        console.error('Fehler beim Aktivieren von Portal', n, e);
      }
    }

    function updatePortalHint() {
      const hint = document.getElementById('portal-hint');
      if(!hint) return;
      if(currentChapter === 1 && portal1Active) {
        hint.textContent = '‚Üí Betrete das Portal';
        hint.classList.add('visible');
      } else {
        hint.classList.remove('visible');
      }
    }

    function loadChapter(num) {
      console.log('Lade Kapitel:', num);
      
      // NEU: Panels schlie√üen beim Kapitelwechsel
      document.getElementById('ai-panel').style.display = 'none';
      document.getElementById('final-panel').style.display = 'none';
      
      // Verstecke alle Kapitel
      document.querySelectorAll('a-entity[id^="chapter"]').forEach(ch => {
        ch.setAttribute('visible', 'false');
      });
      
      // Zeige neues Kapitel
      const newChapter = document.getElementById('chapter' + num);
      if(newChapter) {
        newChapter.setAttribute('visible', 'true');
      }
      
      // NEU: Spieler-Position zur√ºcksetzen
      const rig = document.getElementById('rig');
      if(rig) {
        rig.setAttribute('position', '0 0 4');
      }
      
      currentChapter = num;
      portal1Active = (num === 1) ? false : portal1Active;
      pathChosen = (num === 3) ? false : pathChosen;
      aiUsed = (num === 4) ? false : aiUsed;
      
      // Titel anzeigen
      if(titles[num-1]) {
        document.getElementById('chapter-title').textContent = titles[num-1][0];
        document.getElementById('subtitle').textContent = titles[num-1][1];
        document.getElementById('chapter-title').classList.add('visible');
        document.getElementById('subtitle').classList.add('visible');
        
        setTimeout(() => {
          document.getElementById('chapter-title').classList.remove('visible');
          document.getElementById('subtitle').classList.remove('visible');
        }, 4000);
      }
      
      // Update Progress Dots
      document.querySelectorAll('.prog-dot').forEach((dot, idx) => {
        dot.classList.remove('active', 'complete');
        if(idx < num-1) dot.classList.add('complete');
        if(idx === num-1) dot.classList.add('active');
      });
      
      // Musik starten
      playChapterMusic(num);
    }

    function spawnFloatingLettersAndWords(){
      document.querySelectorAll('.floating-letter,.floating-word').forEach(el=>el.remove());
      const letters='ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
      const words=['Traum','Zeit','Licht','Stille','Wort','Angst','Mut','Nacht','Klang','Raum','Freiheit','Sein','Gedicht','Fluss','Wind','Herz','Schatten','Leben','Blick','Weite','Gedanke','Leere','Stimme','Weg','Frage','Wahrheit','Dunkel','Hoffnung','Seele','Morgen'];
      const blockPos={x:0,y:0.5,z:-3};
      
      for(let i=0;i<30;i++){
        const letter=letters[Math.floor(Math.random()*letters.length)];
        const el=document.createElement('a-text');
        el.setAttribute('value',letter);
        el.setAttribute('color','#bbb');
        el.setAttribute('scale','1.2 1.2 1.2');
        el.className='floating-letter';
        const theta=Math.random()*Math.PI*2;
        const phi=Math.random()*Math.PI;
        const r=2+Math.random()*2;
        const x=blockPos.x+Math.sin(phi)*Math.cos(theta)*r;
        const y=blockPos.y+Math.cos(phi)*r;
        const z=blockPos.z+Math.sin(phi)*Math.sin(theta)*r;
        el.setAttribute('position',`${x} ${y} ${z}`);
        el.setAttribute('animation__pos',`property:position;dir:alternate;dur:${1800+Math.random()*2000};to:${x} ${y+0.5} ${z};loop:true;easing:easeInOutSine`);
        el.setAttribute('animation__rot',`property:rotation;to:${Math.random()*360} ${Math.random()*360} ${Math.random()*360};dur:${3000+Math.random()*3000};loop:true;easing:linear`);
        document.getElementById('chapter1').appendChild(el);
      }
      
      for(let i=0;i<30;i++){
        const word=words[Math.floor(Math.random()*words.length)];
        const el=document.createElement('a-text');
        el.setAttribute('value',word);
        el.setAttribute('color','#888');
        el.setAttribute('scale','0.7 0.7 0.7');
        el.className='floating-word';
        const theta=Math.random()*Math.PI*2;
        const phi=Math.random()*Math.PI;
        const r=2.5+Math.random()*2.5;
        const x=blockPos.x+Math.sin(phi)*Math.cos(theta)*r;
        const y=blockPos.y+Math.cos(phi)*r;
        const z=blockPos.z+Math.sin(phi)*Math.sin(theta)*r;
        el.setAttribute('position',`${x} ${y} ${z}`);
        el.setAttribute('animation__pos',`property:position;dir:alternate;dur:${2200+Math.random()*1800};to:${x} ${y+0.7} ${z};loop:true;easing:easeInOutSine`);
        el.setAttribute('animation__rot',`property:rotation;to:${Math.random()*360} ${Math.random()*360} ${Math.random()*360};dur:${4000+Math.random()*3000};loop:true;easing:linear`);
        document.getElementById('chapter1').appendChild(el);
      }
    }

    function generateAI() {
      const input = document.getElementById('ai-input').value.toLowerCase().trim();
      const key = input in aiTexts ? input : 'default';
      const text = aiTexts[key];
      
      document.getElementById('ai-text').textContent = text;
      document.getElementById('ai-output').style.display = 'block';
      aiUsed = true;
      
      // Portal 4 aktivieren nach AI-Nutzung
      activatePortal(4);
    }

    function closeAI() {
      document.getElementById('ai-panel').style.display = 'none';
      
      // Verstecke VR Keyboard
      const vrKeyboard = document.getElementById('vr-keyboard-ai');
      if(vrKeyboard) {
        vrKeyboard.setAttribute('visible', 'false');
      }
    }

    function submitFinal() {
      const text = document.getElementById('final-input').value;
      if(text.trim()) {
        console.log('Dein Satz:', text);
        
        const exitText = document.getElementById('exit-text');
        if(exitText) {
          exitText.setAttribute('value', 'AUSGANG OFFEN');
          exitText.setAttribute('color', '#2ecc71');
        }
        
        const exitDoor = document.getElementById('exit-door');
        if(exitDoor) {
          exitDoor.setAttribute('color', '#2ecc71');
          exitDoor.setAttribute('material', 'color:#2ecc71;emissive:#2ecc71;emissiveIntensity:0.5');
        }
        
        document.getElementById('final-panel').style.display = 'none';
        
        // Verstecke VR Keyboard
        const vrKeyboard = document.getElementById('vr-keyboard-final');
        if(vrKeyboard) {
          vrKeyboard.setAttribute('visible', 'false');
        }
      }
    }

    // Portal & Interaktions-Events - NUR EINMAL REGISTRIEREN
    let sceneEl = document.querySelector('a-scene');
    
    sceneEl.addEventListener('loaded', function() {
      if(listenersRegistered) return; // NEU: Verhindert Doppel-Registrierung
      listenersRegistered = true;
      console.log('A-Frame Scene geladen, registriere Event-Listener');
      
      // Portal 1 - MIT KAPITEL-CHECK
      const portal1 = document.getElementById('portal1');
      if(portal1) {
        portal1.addEventListener('click', function() {
          if(currentChapter === 1 && portal1Active) loadChapter(2);
        });
      }

      // Portal 2 - MIT KAPITEL-CHECK
      const portal2 = document.getElementById('portal2');
      if(portal2) {
        portal2.addEventListener('click', function() {
          if(currentChapter === 2) loadChapter(3);
        });
      }

      // Portal 3 - MIT KAPITEL-CHECK
      const portal3 = document.getElementById('portal3');
      if(portal3) {
        portal3.addEventListener('click', function() {
          if(currentChapter === 3 && pathChosen) loadChapter(4);
        });
      }

      // Portal 4 - MIT KAPITEL-CHECK
      const portal4 = document.getElementById('portal4');
      if(portal4) {
        portal4.addEventListener('click', function() {
          if(currentChapter === 4 && aiUsed) loadChapter(5);
        });
      }

      // Path Choices - MIT KAPITEL-CHECK
      document.querySelectorAll('.path-choice').forEach(el => {
        el.addEventListener('click', function() {
          if(currentChapter !== 3) return; // NEU
          console.log('Path gew√§hlt:', el.id);
          pathChosen = true;
          
          // Entferne vorherige Highlight
          document.querySelectorAll('.path-choice').forEach(box => {
            box.setAttribute('color', box.id === 'path-left' ? '#3498db' : 
                                     box.id === 'path-middle' ? '#9b59b6' : '#e67e22');
            box.setAttribute('material', 'opacity:0.8');
          });
          
          // Highlight aktuelle Box
          el.setAttribute('color', '#2ecc71');
          el.setAttribute('material', 'color:#2ecc71;emissive:#2ecc71;emissiveIntensity:0.8;opacity:1');
          
          // Zeige Best√§tigung ‚Äì nur eine Perspektive pro Block
          const deadend = document.getElementById('deadend-text');
          if(deadend) {
            deadend.setAttribute('visible', 'true');
            
            let chosenText = '';
            if(el.id === 'path-left') {
              chosenText = "UTOPISCH:\nDie Technologie befreit den menschlichen Geist.\nKreativitaet wird unbegrenzt und demokratisiert.\nJeder kann sein volles Potenzial entfalten.";
            } else if(el.id === 'path-middle') {
              chosenText = "NEUTRAL:\nMensch und Maschine arbeiten zusammen.\nJeder nutzt seine eigenen Staerken optimal.\nDas Ergebnis ist besser als allein.";
            } else {
              chosenText = "DYSTOPISCH:\nWir verlieren uns selbst in unseren Erfindungen.\nIndividualitaet wird zur Datenspur.\nAuthentizitaet stirbt im Algorithmus.";
            }
            
            deadend.setAttribute('value', chosenText);
            deadend.setAttribute('color', '#2ecc71');
            deadend.setAttribute('scale', '0.5 0.5 0.5');
          }
          
          activatePortal(3);
          updatePortalHint();
        });
      });

      // AI Terminal - MIT KAPITEL-CHECK
      const aiTerminal = document.getElementById('ai-terminal');
      if(aiTerminal) {
        aiTerminal.addEventListener('click', function() {
          if(currentChapter !== 4) return; // NEU
          document.getElementById('ai-panel').style.display = 'block';
        });
      }

      // Final Desk - MIT KAPITEL-CHECK
      const finalDesk = document.getElementById('final-desk');
      if(finalDesk) {
        finalDesk.addEventListener('click', function() {
          if(currentChapter !== 5) return; // NEU
          document.getElementById('final-panel').style.display = 'block';
        });
      }

      // Exit Door - MIT KAPITEL-CHECK
      const exitDoor = document.getElementById('exit-door');
      if(exitDoor) {
        exitDoor.addEventListener('click', function() {
          if(currentChapter !== 5) return; // NEU
          loadChapter(6);
        });
      }
    });

    // Auto-Start
    function initGame() {
      console.log('Game initialisiert...');
      
      document.getElementById('start-screen').style.display = 'none';
      document.getElementById('progress').style.display = 'flex';
      document.getElementById('hint').style.display = 'block';
      
      gameStarted = true;
      currentChapter = 1;
      
      document.getElementById('chapter-title').textContent = titles[0][0];
      document.getElementById('subtitle').textContent = titles[0][1];
      document.getElementById('chapter-title').classList.add('visible');
      document.getElementById('subtitle').classList.add('visible');
      
      setTimeout(() => {
        document.getElementById('chapter-title').classList.remove('visible');
        document.getElementById('subtitle').classList.remove('visible');
      }, 4000);
      
      playChapterMusic(1);
      updatePortalHint();
      
      setTimeout(() => spawnFloatingLettersAndWords(), 500);
      
      // Portal nach 15 Sekunden aktivieren
      setTimeout(() => {
        portal1Active = true;
        activatePortal(1);
        updatePortalHint();
        console.log('Portal 1 aktiviert nach 15s!');
      }, 15000);
    }

    if(sceneEl.hasLoaded) {
      initGame();
    } else {
      sceneEl.addEventListener('loaded', initGame);
    }

    // Manueller VR-Button (Fallback)
    function enterVR() {
      const scene = document.querySelector('a-scene');
      if (scene && scene.enterVR) {
        scene.enterVR();
      }
    }

    // Custom VR Button erstellen falls n√∂tig
    window.addEventListener('load', function() {
      setTimeout(function() {
        const vrButton = document.querySelector('.a-enter-vr-button');
        if (!vrButton || !vrButton.offsetParent) {
          const customButton = document.createElement('button');
          customButton.textContent = 'VR STARTEN';
          customButton.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
            background: #2196F3;
            color: white;
            border: 2px solid white;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
          `;
          customButton.onclick = enterVR;
          document.body.appendChild(customButton);
          console.log('Custom VR Button erstellt');
        }
      }, 1000);
    });
    
    // ===== VR CONTROLLER CLICK SUPPORT =====
    AFRAME.registerComponent('vr-click-handler', {
      init: function() {
        const scene = this.el.sceneEl;
        
        // Trigger-Events f√ºr Controller
        scene.addEventListener('triggerdown', (evt) => {
          this.handleVRClick(evt.target);
        });
        
        // Auch f√ºr selectstart (WebXR)
        scene.addEventListener('selectstart', (evt) => {
          this.handleVRClick(evt.target);
        });
      },
      
      handleVRClick: function(controller) {
        if (!controller) return;
        
        const raycaster = controller.components.raycaster;
        if (raycaster) {
          const intersections = raycaster.intersections;
          if (intersections && intersections.length > 0) {
            const target = intersections[0].object.el;
            if (target) {
              target.emit('click');
              console.log('VR Click auf:', target.id || target.className);
            }
          }
        }
      }
    });

    // Komponenten registrieren wenn Scene geladen
    sceneEl = sceneEl || document.querySelector('a-scene');
    
    sceneEl.addEventListener('loaded', function() {
      console.log('A-Frame Scene geladen');
      
      // VR Click Handler zur Scene hinzuf√ºgen
      scene.setAttribute('vr-click-handler', '');
      
      // Portal 1 - MIT KAPITEL-CHECK
      const portal1 = document.getElementById('portal1');
      if(portal1) {
        portal1.addEventListener('click', function() {
          if(currentChapter === 1 && portal1Active) loadChapter(2);
        });
      }

      // Portal 2 - MIT KAPITEL-CHECK
      const portal2 = document.getElementById('portal2');
      if(portal2) {
        portal2.addEventListener('click', function() {
          if(currentChapter === 2) loadChapter(3);
        });
      }

      // Portal 3 - MIT KAPITEL-CHECK
      const portal3 = document.getElementById('portal3');
      if(portal3) {
        portal3.addEventListener('click', function() {
          if(currentChapter === 3 && pathChosen) loadChapter(4);
        });
      }

      // Portal 4 - MIT KAPITEL-CHECK
      const portal4 = document.getElementById('portal4');
      if(portal4) {
        portal4.addEventListener('click', function() {
          if(currentChapter === 4 && aiUsed) loadChapter(5);
        });
      }

      // Path Choices - MIT KAPITEL-CHECK
      document.querySelectorAll('.path-choice').forEach(el => {
        el.addEventListener('click', function() {
          if(currentChapter !== 3) return; // NEU
          console.log('Path gew√§hlt:', el.id);
          pathChosen = true;
          
          // Entferne vorherige Highlight
          document.querySelectorAll('.path-choice').forEach(box => {
            box.setAttribute('color', box.id === 'path-left' ? '#3498db' : 
                                     box.id === 'path-middle' ? '#9b59b6' : '#e67e22');
            box.setAttribute('material', 'opacity:0.8');
          });
          
          // Highlight aktuelle Box
          el.setAttribute('color', '#2ecc71');
          el.setAttribute('material', 'color:#2ecc71;emissive:#2ecc71;emissiveIntensity:0.8;opacity:1');
          
          // Zeige Best√§tigung ‚Äì nur eine Perspektive pro Block
          const deadend = document.getElementById('deadend-text');
          if(deadend) {
            deadend.setAttribute('visible', 'true');
            
            let chosenText = '';
            if(el.id === 'path-left') {
              chosenText = "UTOPISCH:\nDie Technologie befreit den menschlichen Geist.\nKreativitaet wird unbegrenzt und demokratisiert.\nJeder kann sein volles Potenzial entfalten.";
            } else if(el.id === 'path-middle') {
              chosenText = "NEUTRAL:\nMensch und Maschine arbeiten zusammen.\nJeder nutzt seine eigenen Staerken optimal.\nDas Ergebnis ist besser als allein.";
            } else {
              chosenText = "DYSTOPISCH:\nWir verlieren uns selbst in unseren Erfindungen.\nIndividualitaet wird zur Datenspur.\nAuthentizitaet stirbt im Algorithmus.";
            }
            
            deadend.setAttribute('value', chosenText);
            deadend.setAttribute('color', '#2ecc71');
            deadend.setAttribute('scale', '0.5 0.5 0.5');
          }
          
          activatePortal(3);
          updatePortalHint();
        });
      });

      // AI Terminal - MIT KAPITEL-CHECK
      const aiTerminal = document.getElementById('ai-terminal');
      if(aiTerminal) {
        aiTerminal.addEventListener('click', function() {
          if(currentChapter !== 4) return; // NEU
          document.getElementById('ai-panel').style.display = 'block';
        });
      }

      // Final Desk - MIT KAPITEL-CHECK
      const finalDesk = document.getElementById('final-desk');
      if(finalDesk) {
        finalDesk.addEventListener('click', function() {
          if(currentChapter !== 5) return; // NEU
          document.getElementById('final-panel').style.display = 'block';
        });
      }

      // Exit Door - MIT KAPITEL-CHECK
      const exitDoor = document.getElementById('exit-door');
      if(exitDoor) {
        exitDoor.addEventListener('click', function() {
          if(currentChapter !== 5) return; // NEU
          loadChapter(6);
        });
      }
    });

    // Auto-Start
    function initGame() {
      console.log('Game initialisiert...');
      
      document.getElementById('start-screen').style.display = 'none';
      document.getElementById('progress').style.display = 'flex';
      document.getElementById('hint').style.display = 'block';
      
      gameStarted = true;
      currentChapter = 1;
      
      document.getElementById('chapter-title').textContent = titles[0][0];
      document.getElementById('subtitle').textContent = titles[0][1];
      document.getElementById('chapter-title').classList.add('visible');
      document.getElementById('subtitle').classList.add('visible');
      
      setTimeout(() => {
        document.getElementById('chapter-title').classList.remove('visible');
        document.getElementById('subtitle').classList.remove('visible');
      }, 4000);
      
      playChapterMusic(1);
      updatePortalHint();
      
      setTimeout(() => spawnFloatingLettersAndWords(), 500);
      
      // Portal nach 15 Sekunden aktivieren
      setTimeout(() => {
        portal1Active = true;
        activatePortal(1);
        updatePortalHint();
        console.log('Portal 1 aktiviert nach 15s!');
      }, 15000);
    }

    if(sceneEl.hasLoaded) {
      initGame();
    } else {
      sceneEl.addEventListener('loaded', initGame);
    }

    // Manueller VR-Button (Fallback)
    function enterVR() {
      const scene = document.querySelector('a-scene');
      if (scene && scene.enterVR) {
        scene.enterVR();
      }
    }

    // Custom VR Button erstellen falls n√∂tig
    window.addEventListener('load', function() {
      setTimeout(function() {
        const vrButton = document.querySelector('.a-enter-vr-button');
        if (!vrButton || !vrButton.offsetParent) {
          const customButton = document.createElement('button');
          customButton.textContent = 'VR STARTEN';
          customButton.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
            background: #2196F3;
            color: white;
            border: 2px solid white;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
          `;
          customButton.onclick = enterVR;
          document.body.appendChild(customButton);
          console.log('Custom VR Button erstellt');
        }
      }, 1000);
    });
    
    // ===== VR CONTROLLER CLICK SUPPORT =====
    AFRAME.registerComponent('vr-click-handler', {
      init: function() {
        const scene = this.el.sceneEl;
        
        // Trigger-Events f√ºr Controller
        scene.addEventListener('triggerdown', (evt) => {
          this.handleVRClick(evt.target);
        });
        
        // Auch f√ºr selectstart (WebXR)
        scene.addEventListener('selectstart', (evt) => {
          this.handleVRClick(evt.target);
        });
      },
      
      handleVRClick: function(controller) {
        if (!controller) return;
        
        const raycaster = controller.components.raycaster;
        if (raycaster) {
          const intersections = raycaster.intersections;
          if (intersections && intersections.length > 0) {
            const target = intersections[0].object.el;
            if (target) {
              target.emit('click');
              console.log('VR Click auf:', target.id || target.className);
            }
          }
        }
      }
    });

    // Komponenten registrieren wenn Scene geladen
    sceneEl = sceneEl || document.querySelector('a-scene');
    
    sceneEl.addEventListener('loaded', function() {
      console.log('A-Frame Scene geladen');
      
      // VR Click Handler zur Scene hinzuf√ºgen
      scene.setAttribute('vr-click-handler', '');
      
      // Portal 1 - MIT KAPITEL-CHECK
      const portal1 = document.getElementById('portal1');
      if(portal1) {
        portal1.addEventListener('click', function() {
          if(currentChapter === 1 && portal1Active) loadChapter(2);
        });
      }

      // Portal 2 - MIT KAPITEL-CHECK
      const portal2 = document.getElementById('portal2');
      if(portal2) {
        portal2.addEventListener('click', function() {
          if(currentChapter === 2) loadChapter(3);
        });
      }

      // Portal 3 - MIT KAPITEL-CHECK
      const portal3 = document.getElementById('portal3');
      if(portal3) {
        portal3.addEventListener('click', function() {
          if(currentChapter === 3 && pathChosen) loadChapter(4);
        });
      }

      // Portal 4 - MIT KAPITEL-CHECK
      const portal4 = document.getElementById('portal4');
      if(portal4) {
        portal4.addEventListener('click', function() {
          if(currentChapter === 4 && aiUsed) loadChapter(5);
        });
      }

      // Path Choices - MIT KAPITEL-CHECK
      document.querySelectorAll('.path-choice').forEach(el => {
        el.addEventListener('click', function() {
          if(currentChapter !== 3) return; // NEU
          console.log('Path gew√§hlt:', el.id);
          pathChosen = true;
          
          // Entferne vorherige Highlight
          document.querySelectorAll('.path-choice').forEach(box => {
            box.setAttribute('color', box.id === 'path-left' ? '#3498db' : 
                                     box.id === 'path-middle' ? '#9b59b6' : '#e67e22');
            box.setAttribute('material', 'opacity:0.8');
          });
          
          // Highlight aktuelle Box
          el.setAttribute('color', '#2ecc71');
          el.setAttribute('material', 'color:#2ecc71;emissive:#2ecc71;emissiveIntensity:0.8;opacity:1');
          
          // Zeige Best√§tigung ‚Äì nur eine Perspektive pro Block
          const deadend = document.getElementById('deadend-text');
          if(deadend) {
            deadend.setAttribute('visible', 'true');
            
            let chosenText = '';
            if(el.id === 'path-left') {
              chosenText = "UTOPISCH:\nDie Technologie befreit den menschlichen Geist.\nKreativitaet wird unbegrenzt und demokratisiert.\nJeder kann sein volles Potenzial entfalten.";
            } else if(el.id === 'path-middle') {
              chosenText = "NEUTRAL:\nMensch und Maschine arbeiten zusammen.\nJeder nutzt seine eigenen Staerken optimal.\nDas Ergebnis ist besser als allein.";
            } else {
              chosenText = "DYSTOPISCH:\nWir verlieren uns selbst in unseren Erfindungen.\nIndividualitaet wird zur Datenspur.\nAuthentizitaet stirbt im Algorithmus.";
            }
            
            deadend.setAttribute('value', chosenText);
            deadend.setAttribute('color', '#2ecc71');
            deadend.setAttribute('scale', '0.5 0.5 0.5');
          }
          
          activatePortal(3);
          updatePortalHint();
        });
      });

      // AI Terminal - MIT KAPITEL-CHECK
      const aiTerminal = document.getElementById('ai-terminal');
      if(aiTerminal) {
        aiTerminal.addEventListener('click', function() {
          if(currentChapter !== 4) return; // NEU
          document.getElementById('ai-panel').style.display = 'block';
        });
      }

      // Final Desk - MIT KAPITEL-CHECK
      const finalDesk = document.getElementById('final-desk');
      if(finalDesk) {
        finalDesk.addEventListener('click', function() {
          if(currentChapter !== 5) return; // NEU
          document.getElementById('final-panel').style.display = 'block';
        });
      }

      // Exit Door - MIT KAPITEL-CHECK
      const exitDoor = document.getElementById('exit-door');
      if(exitDoor) {
        exitDoor.addEventListener('click', function() {
          if(currentChapter !== 5) return; // NEU
          loadChapter(6);
        });
      }
    });

    // Auto-Start
    function initGame() {
      console.log('Game initialisiert...');
      
      document.getElementById('start-screen').style.display = 'none';
      document.getElementById('progress').style.display = 'flex';
      document.getElementById('hint').style.display = 'block';
      
      gameStarted = true;
      currentChapter = 1;
      
      document.getElementById('chapter-title').textContent = titles[0][0];
      document.getElementById('subtitle').textContent = titles[0][1];
      document.getElementById('chapter-title').classList.add('visible');
      document.getElementById('subtitle').classList.add('visible');
      
      setTimeout(() => {
        document.getElementById('chapter-title').classList.remove('visible');
        document.getElementById('subtitle').classList.remove('visible');
      }, 4000);
      
      playChapterMusic(1);
      updatePortalHint();
      
      setTimeout(() => spawnFloatingLettersAndWords(), 500);
      
      // Portal nach 15 Sekunden aktivieren
      setTimeout(() => {
        portal1Active = true;
        activatePortal(1);
        updatePortalHint();
        console.log('Portal 1 aktiviert nach 15s!');
      }, 15000);
    }

    if(sceneEl.hasLoaded) {
      initGame();
    } else {
      sceneEl.addEventListener('loaded', initGame);
    }

    // Manueller VR-Button (Fallback)
    function enterVR() {
      const scene = document.querySelector('a-scene');
      if (scene && scene.enterVR) {
        scene.enterVR();
      }
    }

    // Custom VR Button erstellen falls n√∂tig
    window.addEventListener('load', function() {
      setTimeout(function() {
        const vrButton = document.querySelector('.a-enter-vr-button');
        if (!vrButton || !vrButton.offsetParent) {
          const customButton = document.createElement('button');
          customButton.textContent = 'VR STARTEN';
          customButton.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
            background: #2196F3;
            color: white;
            border: 2px solid white;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
          `;
          customButton.onclick = enterVR;
          document.body.appendChild(customButton);
          console.log('Custom VR Button erstellt');
        }
      }, 1000);
    });
    
    // ===== VR CONTROLLER CLICK SUPPORT =====
    AFRAME.registerComponent('vr-click-handler', {
      init: function() {
        const scene = this.el.sceneEl;
        
        // Trigger-Events f√ºr Controller
        scene.addEventListener('triggerdown', (evt) => {
          this.handleVRClick(evt.target);
        });
        
        // Auch f√ºr selectstart (WebXR)
        scene.addEventListener('selectstart', (evt) => {
          this.handleVRClick(evt.target);
        });
      },
      
      handleVRClick: function(controller) {
        if (!controller) return;
        
        const raycaster = controller.components.raycaster;
        if (raycaster) {
          const intersections = raycaster.intersections;
          if (intersections && intersections.length > 0) {
            const target = intersections[0].object.el;
            if (target) {
              target.emit('click');
              console.log('VR Click auf:', target.id || target.className);
            }
          }
        }
      }
    });

    // Komponenten registrieren wenn Scene geladen
    sceneEl = sceneEl || document.querySelector('a-scene');
    
    sceneEl.addEventListener('loaded', function() {
      console.log('A-Frame Scene geladen');
      
      // VR Click Handler zur Scene hinzuf√ºgen
      scene.setAttribute('vr-click-handler', '');
      
      // Portal 1 - MIT KAPITEL-CHECK
      const portal1 = document.getElementById('portal1');
      if(portal1) {
        portal1.addEventListener('click', function() {
          if(currentChapter === 1 && portal1Active) loadChapter(2);
        });
      }

      // Portal 2 - MIT KAPITEL-CHECK
      const portal2 = document.getElementById('portal2');
      if(portal2) {
        portal2.addEventListener('click', function() {
          if(currentChapter === 2) loadChapter(3);
        });
      }

      // Portal 3 - MIT KAPITEL-CHECK
      const portal3 = document.getElementById('portal3');
      if(portal3) {
        portal3.addEventListener('click', function() {
          if(currentChapter === 3 && pathChosen) loadChapter(4);
        });
      }

      // Portal 4 - MIT KAPITEL-CHECK
      const portal4 = document.getElementById('portal4');
      if(portal4) {
        portal4.addEventListener('click', function() {
          if(currentChapter === 4 && aiUsed) loadChapter(5);
        });
      }

      // Path Choices - MIT KAPITEL-CHECK
      document.querySelectorAll('.path-choice').forEach(el => {
        el.addEventListener('click', function() {
          if(currentChapter !== 3) return; // NEU
          console.log('Path gew√§hlt:', el.id);
          pathChosen = true;
          
          // Entferne vorherige Highlight
          document.querySelectorAll('.path-choice').forEach(box => {
            box.setAttribute('color', box.id === 'path-left' ? '#3498db' : 
                                     box.id === 'path-middle' ? '#9b59b6' : '#e67e22');
            box.setAttribute('material', 'opacity:0.8');
          });
          
          // Highlight aktuelle Box
          el.setAttribute('color', '#2ecc71');
          el.setAttribute('material', 'color:#2ecc71;emissive:#2ecc71;emissiveIntensity:0.8;opacity:1');
          
          // Zeige Best√§tigung ‚Äì nur eine Perspektive pro Block
          const deadend = document.getElementById('deadend-text');
          if(deadend) {
            deadend.setAttribute('visible', 'true');
            
            let chosenText = '';
            if(el.id === 'path-left') {
              chosenText = "UTOPISCH:\nDie Technologie befreit den menschlichen Geist.\nKreativitaet wird unbegrenzt und demokratisiert.\nJeder kann sein volles Potenzial entfalten.";
            } else if(el.id === 'path-middle') {
              chosenText = "NEUTRAL:\nMensch und Maschine arbeiten zusammen.\nJeder nutzt seine eigenen Staerken optimal.\nDas Ergebnis ist besser als allein.";
            } else {
              chosenText = "DYSTOPISCH:\nWir verlieren uns selbst in unseren Erfindungen.\nIndividualitaet wird zur Datenspur.\nAuthentizitaet stirbt im Algorithmus.";
            }
            
            deadend.setAttribute('value', chosenText);
            deadend.setAttribute('color', '#2ecc71');
            deadend.setAttribute('scale', '0.5 0.5 0.5');
          }
          
          activatePortal(3);
          updatePortalHint();
        });
      });

      // AI Terminal - MIT KAPITEL-CHECK
      const aiTerminal = document.getElementById('ai-terminal');
      if(aiTerminal) {
        aiTerminal.addEventListener('click', function() {
          if(currentChapter !== 4) return; // NEU
          document.getElementById('ai-panel').style.display = 'block';
        });
      }

      // Final Desk - MIT KAPITEL-CHECK
      const finalDesk = document.getElementById('final-desk');
      if(finalDesk) {
        finalDesk.addEventListener('click', function() {
          if(currentChapter !== 5) return; // NEU
          document.getElementById('final-panel').style.display = 'block';
        });
      }

      // Exit Door - MIT KAPITEL-CHECK
      const exitDoor = document.getElementById('exit-door');
      if(exitDoor) {
        exitDoor.addEventListener('click', function() {
          if(currentChapter !== 5) return; // NEU
          loadChapter(6);
        });
      }
    });

    // Auto-Start
    function initGame() {
      console.log('Game initialisiert...');
      
      document.getElementById('start-screen').style.display = 'none';
      document.getElementById('progress').style.display = 'flex';
      document.getElementById('hint').style.display = 'block';
      
      gameStarted = true;
      currentChapter = 1;
      
      document.getElementById('chapter-title').textContent = titles[0][0];
      document.getElementById('subtitle').textContent = titles[0][1];
      document.getElementById('chapter-title').classList.add('visible');
      document.getElementById('subtitle').classList.add('visible');
      
      setTimeout(() => {
        document.getElementById('chapter-title').classList.remove('visible');
        document.getElementById('subtitle').classList.remove('visible');
      }, 4000);
      
      playChapterMusic(1);
      updatePortalHint();
      
      setTimeout(() => spawnFloatingLettersAndWords(), 500);
      
      // Portal nach 15 Sekunden aktivieren
      setTimeout(() => {
        portal1Active = true;
        activatePortal(1);
        updatePortalHint();
        console.log('Portal 1 aktiviert nach 15s!');
      }, 15000);
    }

    if(sceneEl.hasLoaded) {
      initGame();
    } else {
      sceneEl.addEventListener('loaded', initGame);
    }

    // Manueller VR-Button (Fallback)
    function enterVR() {
      const scene = document.querySelector('a-scene');
      if (scene && scene.enterVR) {
        scene.enterVR();
      }
    }

    // Custom VR Button erstellen falls n√∂tig
    window.addEventListener('load', function() {
      setTimeout(function() {
        const vrButton = document.querySelector('.a-enter-vr-button');
        if (!vrButton || !vrButton.offsetParent) {
          const customButton = document.createElement('button');
          customButton.textContent = 'VR STARTEN';
          customButton.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
            background: #2196F3;
            color: white;
            border: 2px solid white;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
          `;
          customButton.onclick = enterVR;
          document.body.appendChild(customButton);
          console.log('Custom VR Button erstellt');
        }
      }, 1000);
    });
    
    // ===== VR CONTROLLER MOVEMENT =====
    AFRAME.registerComponent('thumbstick-controls', {
      schema: {
        speed: { type: 'number', default: 0.05 },
        turnSpeed: { type: 'number', default: 2 }
      },
      
      init: function() {
        this.velocity = new THREE.Vector3();
        this.direction = new THREE.Vector3();
        this.rotation = new THREE.Euler();
        
        // Linker Controller: Bewegung
        this.leftAxisX = 0;
        this.leftAxisY = 0;
        
        // Rechter Controller: Drehung
        this.rightAxisX = 0;
        
        // Event Listener f√ºr Controller
        this.el.sceneEl.addEventListener('axismove', this.onAxisMove.bind(this));
      },
      
      onAxisMove: function(evt) {
        const hand = evt.target.getAttribute('oculus-touch-controls')?.hand ||
                     evt.target.getAttribute('vive-controls')?.hand ||
                     evt.target.getAttribute('windows-motion-controls')?.hand ||
                     evt.target.id;
        
        if (hand === 'left' || hand === 'leftHand') {
          // Linker Stick: Vorw√§rts/R√ºckw√§rts & Seitw√§rts
          this.leftAxisX = evt.detail.axis[2] || evt.detail.axis[0] || 0;
          this.leftAxisY = evt.detail.axis[3] || evt.detail.axis[1] || 0;
        } else if (hand === 'right' || hand === 'rightHand') {
          // Rechter Stick: Drehung
          this.rightAxisX = evt.detail.axis[2] || evt.detail.axis[0] || 0;
        }
      },
      
      tick: function(time, delta) {
        if (!delta) return;
        
        const rig = this.el;
        const camera = document.getElementById('camera');
        
        // Deadzone f√ºr Thumbsticks
        const deadzone = 0.15;
        const leftX = Math.abs(this.leftAxisX) > deadzone ? this.leftAxisX : 0;
        const leftY = Math.abs(this.leftAxisY) > deadzone ? this.leftAxisY : 0;
        const rightX = Math.abs(this.rightAxisX) > deadzone ? this.rightAxisX : 0;
        
        // Bewegung basierend auf Kamera-Blickrichtung
        if (leftX !== 0 || leftY !== 0) {
          const cameraRotation = camera.getAttribute('rotation');
          const angle = THREE.MathUtils.degToRad(cameraRotation.y);
          
          // Bewegungsrichtung berechnen
          const moveX = -leftX * Math.cos(angle) - leftY * Math.sin(angle);
          const moveZ = leftX * Math.sin(angle) - leftY * Math.cos(angle);
          
          // Position aktualisieren
          const position = rig.getAttribute('position');
          const speed = this.data.speed * (delta / 16.67); // Normalisiert auf 60fps
          
          position.x += moveX * speed;
          position.z += moveZ * speed;
          
          rig.setAttribute('position', position);
        }
        
        // Snap-Turn Drehung (rechter Stick)
        if (rightX !== 0) {
          const rotation = rig.getAttribute('rotation') || { x: 0, y: 0, z: 0 };
          rotation.y -= rightX * this.data.turnSpeed * (delta / 16.67);
          rig.setAttribute('rotation', rotation);
        }
      }
    });

    // Alternative: Kontinuierliche Stick-Bewegung Komponente
    AFRAME.registerComponent('vr-movement', {
      schema: {
        speed: { type: 'number', default: 3 },
        fly: { type: 'boolean', default: false }
      },
      
      init: function() {
        this.thumbstickInput = { x: 0, y: 0 };
        this.turnInput = 0;
        
        // F√ºr beide H√§nde Events registrieren
        const leftHand = document.getElementById('leftHand');
        const rightHand = document.getElementById('rightHand');
        
        if (leftHand) {
          leftHand.addEventListener('thumbstickmoved', this.onLeftThumbstick.bind(this));
          leftHand.addEventListener('axismove', this.onLeftAxis.bind(this));
        }
        
        if (rightHand) {
          rightHand.addEventListener('thumbstickmoved', this.onRightThumbstick.bind(this));
          rightHand.addEventListener('axismove', this.onRightAxis.bind(this));
        }
      },
      
      onLeftThumbstick: function(evt) {
        this.thumbstickInput.x = evt.detail.x;
        this.thumbstickInput.y = evt.detail.y;
      },
      
      onLeftAxis: function(evt) {
        if (evt.detail.axis) {
          this.thumbstickInput.x = evt.detail.axis[2] || evt.detail.axis[0] || 0;
          this.thumbstickInput.y = evt.detail.axis[3] || evt.detail.axis[1] || 0;
        }
      },
      
      onRightThumbstick: function(evt) {
        this.turnInput = evt.detail.x;
      },
      
      onRightAxis: function(evt) {
        if (evt.detail.axis) {
          this.turnInput = evt.detail.axis[2] || evt.detail.axis[0] || 0;
        }
      },
      
      tick: function(time, delta) {
        if (!delta) return;
        
        const dt = delta / 1000; // Delta in Sekunden
        const deadzone = 0.1;
        
        // Bewegung
        const inputX = Math.abs(this.thumbstickInput.x) > deadzone ? this.thumbstickInput.x : 0;
        const inputY = Math.abs(this.thumbstickInput.y) > deadzone ? this.thumbstickInput.y : 0;
        
        if (inputX !== 0 || inputY !== 0) {
          const camera = document.getElementById('camera');
          const cameraEl = camera.object3D;
          
          // Richtung aus Kamera-Rotation
          const direction = new THREE.Vector3();
          cameraEl.getWorldDirection(direction);
          direction.y = this.data.fly ? direction.y : 0;
          direction.normalize();
          
          // Seitw√§rts-Vektor
          const right = new THREE.Vector3();
          right.crossVectors(direction, new THREE.Vector3(0, 1, 0)).normalize();
          
          // Bewegungsvektor
          const movement = new THREE.Vector3();
          movement.addScaledVector(direction, -inputY * this.data.speed * dt);
          movement.addScaledVector(right, inputX * this.data.speed * dt);
          
          // Position anwenden
          const position = this.el.getAttribute('position');
          position.x += movement.x;
          if (this.data.fly) position.y += movement.y;
          position.z += movement.z;
          this.el.setAttribute('position', position);
        }
        
        // Drehung
        const turnX = Math.abs(this.turnInput) > deadzone ? this.turnInput : 0;
        if (turnX !== 0) {
          const rotation = this.el.getAttribute('rotation') || { x: 0, y: 0, z: 0 };
          rotation.y -= turnX * 60 * dt; // 60 Grad pro Sekunde
          this.el.setAttribute('rotation', rotation);
        }
      }
    });

    // Komponente zum Rig hinzuf√ºgen wenn Scene geladen
    sceneEl.addEventListener('loaded', function() {
      const rig = document.getElementById('rig');
      if (rig) {
        rig.setAttribute('thumbstick-controls', 'speed: 0.06; turnSpeed: 2.5');
        rig.setAttribute('vr-movement', 'speed: 3; fly: false');
        console.log('VR Controller Movement aktiviert');
      }
    });

    // ...existing code (initGame, etc.)...
  </script>
</body>
</html>